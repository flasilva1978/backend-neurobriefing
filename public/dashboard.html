<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard NeuroBriefing | Diagn√≥stico Integral</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* ==========================================================================
           1. ESTILOS GERAIS E RESET
           ========================================================================== */
        * {
            box-sizing: border-box;
            -webkit-print-color-adjust: exact;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        /* ==========================================================================
           2. ESTILOS DO PAINEL (TELA)
           ========================================================================== */
        .painel {
            max-width: 1200px;
            margin: 0 auto 30px auto;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .header-painel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .hp-title {
            font-size: 18pt;
            font-weight: 800;
            color: #2c3e50;
        }

        .btn-refresh {
            background: #2c3e50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 700;
            font-size: 9pt;
            transition: 0.2s;
        }

        .btn-refresh:hover {
            background: #34495e;
        }

        /* TABELA */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 15px 10px;
            background: #f8f9fa;
            color: #7f8c8d;
            font-weight: 700;
            font-size: 8pt;
            text-transform: uppercase;
            border-bottom: 2px solid #eee;
        }

        td {
            padding: 15px 10px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
            font-size: 9.5pt;
        }

        tr:hover {
            background-color: #fafafa;
        }

        .cli-name {
            font-size: 11pt;
            font-weight: 700;
            color: #2c3e50;
            display: block;
            margin-bottom: 4px;
        }

        .cli-local {
            font-size: 8pt;
            color: #999;
            display: block;
            margin-bottom: 8px;
        }

        .mod-grid {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .mod-tag {
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 7pt;
            font-weight: 700;
            text-transform: uppercase;
            background: #eee;
            color: #bbb;
            border: 1px solid #e0e0e0;
        }

        .mod-tag.done {
            background: #e8f5e9;
            color: #27ae60;
            border-color: #c8e6c9;
        }

        .btn-pdf {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 8pt;
            cursor: pointer;
        }

        .btn-pdf:hover {
            background: #c0392b;
        }

        .btn-pdf:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* ==========================================================================
           3. ESTILOS DO PDF (A4)
           ========================================================================== */
        #pdf-root {
            display: none;
        }

        .page {
            width: 210mm;
            height: 296mm;
            background: white;
            position: relative;
            overflow: hidden;
            margin: 0 auto;
            page-break-after: always;
            padding: 0;
        }

        .page:last-child {
            page-break-after: avoid;
        }

        /* CAPA */
        .capa-box {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 20mm solid #f4f6f8;
            text-align: center;
        }

        .c-logo {
            font-size: 38pt;
            font-weight: 900;
            color: #2c3e50;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .c-sub {
            font-size: 10pt;
            letter-spacing: 4px;
            text-transform: uppercase;
            color: #7f8c8d;
            margin-bottom: 80px;
        }

        .c-info {
            width: 80%;
            border-top: 2px solid #2c3e50;
            border-bottom: 2px solid #2c3e50;
            padding: 40px 0;
            margin-bottom: 50px;
        }

        .ci-lbl {
            font-size: 8pt;
            font-weight: 700;
            color: #aaa;
            text-transform: uppercase;
            margin-bottom: 5px;
            display: block;
            letter-spacing: 1px;
        }

        .ci-val {
            font-size: 16pt;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 25px;
            display: block;
        }

        .c-foot {
            position: absolute;
            bottom: 15mm;
            font-size: 8pt;
            color: #ccc;
            text-transform: uppercase;
        }

        /* HEADER DO MODULO */
        .mod-content {
            padding: 15mm 15mm 10mm 15mm;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .m-head {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            border-bottom: 4px solid #2c3e50;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .mh-tit {
            font-size: 22pt;
            font-weight: 800;
            color: #2c3e50;
            line-height: 1;
        }

        .mh-sub {
            font-size: 9pt;
            font-weight: 600;
            color: #7f8c8d;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .mh-meta {
            text-align: right;
        }

        .mh-num {
            font-size: 30pt;
            font-weight: 900;
            color: #eee;
            line-height: 0.8;
        }

        .mh-time {
            font-size: 8pt;
            font-weight: 700;
            color: #e74c3c;
            margin-top: 5px;
            display: block;
        }

        /* BOXES DE CONTE√öDO */
        .win-box {
            border: 1px solid #ccc;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .wb-head {
            padding: 10px 15px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .wb-tit {
            font-size: 14pt;
            font-weight: 800;
            text-transform: uppercase;
        }

        .wb-sty {
            font-size: 8pt;
            font-weight: 600;
            opacity: 0.95;
            text-transform: uppercase;
        }

        .wb-body {
            padding: 20px;
            flex: 1;
        }

        /* GRIDS ESTRAT√âGICOS */
        .strategy-grid {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .st-card {
            flex: 1;
            background: #fdfdfd;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .st-card.highlight {
            border-left: 4px solid #3498db;
            background: #fbfdff;
        }

        .st-card.shadow-card {
            border-left: 4px solid #f1c40f;
            background: #fffcf5;
        }

        .st-head {
            font-size: 9pt;
            font-weight: 800;
            color: #2c3e50;
            text-transform: uppercase;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 2px solid #eee;
        }

        .st-text {
            font-size: 8.5pt;
            color: #555;
            line-height: 1.5;
            text-align: justify;
        }

        /* GR√ÅFICOS */
        .charts {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            height: 40px;
        }

        .cc-box {
            flex: 1;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 5px 8px;
            background: #fafafa;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .cc-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cc-lbl {
            font-size: 8pt;
            font-weight: 800;
            text-transform: uppercase;
        }

        .cc-val {
            font-size: 11pt;
            font-weight: 900;
        }

        .cc-bar {
            width: 100%;
            height: 5px;
            background: #ddd;
            border-radius: 3px;
            overflow: hidden;
        }

        .cc-fill {
            height: 100%;
        }

        /* RODAP√â */
        .box-conclusao {
            background: #fdfdfd;
            border-left: 4px solid #2c3e50;
            padding: 15px;
            font-size: 9pt;
            color: #555;
            line-height: 1.5;
            margin-top: auto;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }

        .bc-tit {
            font-weight: 800;
            color: #2c3e50;
            text-transform: uppercase;
            margin-bottom: 8px;
            font-size: 10pt;
            display: block;
        }

        .ft-note {
            text-align: center;
            font-size: 6pt;
            color: #bbb;
            padding-top: 5px;
        }

        /* LISTAS E GRIDS */
        .info-row {
            margin-bottom: 8px;
            border-bottom: 1px dashed #eee;
            padding-bottom: 4px;
        }

        .il {
            font-size: 7pt;
            font-weight: 700;
            color: #999;
            text-transform: uppercase;
            display: block;
            margin-bottom: 2px;
        }

        .iv {
            font-size: 10pt;
            font-weight: 600;
            color: #333;
            line-height: 1.25;
        }

        .item-list {
            margin-bottom: 8px;
            border-bottom: 1px dashed #eee;
            padding-bottom: 8px;
        }

        .il-lbl {
            font-size: 8pt;
            font-weight: 700;
            color: #2c3e50;
            text-transform: uppercase;
            display: block;
            margin-bottom: 3px;
        }

        .il-val {
            font-size: 9pt;
            color: #555;
        }

        .grid-2 {
            display: flex;
            gap: 20px;
        }

        .col {
            flex: 1;
        }

        /* ==========================================================================
           M√ìDULO 2 - PROTOCOLO T√âCNICO (LISTAS)
           ========================================================================== */
        .tech-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .tech-item {
            position: relative;
            padding-left: 15px;
            margin-bottom: 6px;
            font-size: 8.5pt;
            color: #555;
            line-height: 1.3;
        }

        .tech-item::before {
            content: '‚Ä¢';
            position: absolute;
            left: 0;
            color: #2c3e50;
            font-weight: bold;
        }

        .tech-item.bad::before {
            content: '‚úï';
            color: #e74c3c;
        }

        .dna-box {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .dna-color {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 1px solid #ddd;
        }

        /* ==========================================================================
           M√ìDULO 3 - GRID SENSORIAL DETALHADO (4 POR P√ÅGINA)
           ========================================================================== */
        .sensory-page-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 20px;
            flex: 1;
            margin-bottom: 20px;
        }

        .sense-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.03);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Cores de Borda */
        .sense-card.s-vis { border-top: 5px solid #f39c12; }
        .sense-card.s-aud { border-top: 5px solid #9b59b6; }
        .sense-card.s-olf { border-top: 5px solid #27ae60; }
        .sense-card.s-tat { border-top: 5px solid #e67e22; }
        .sense-card.s-prop { border-top: 5px solid #c0392b; }
        .sense-card.s-gus { border-top: 5px solid #e84393; }
        .sense-card.s-emo { border-top: 5px solid #8e44ad; }
        .sense-card.s-cog { border-top: 5px solid #2980b9; }

        .sense-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .sense-title {
            font-size: 10pt;
            font-weight: 800;
            color: #2c3e50;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sense-icon {
            font-size: 14pt;
        }

        .sense-bar-container {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .sense-bar-bg {
            flex: 1;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .sense-bar-fill {
            height: 100%;
            border-radius: 4px;
        }

        .sense-val {
            font-size: 11pt;
            font-weight: 800;
            width: 40px;
            text-align: right;
            margin-left: 10px;
        }

        /* BLOCOS DE TEXTO (DIAGN√ìSTICO/A√á√ÉO/NEURO) */
        .sense-section {
            margin-bottom: 10px;
        }

        .sense-lbl {
            font-size: 7.5pt;
            font-weight: 700;
            color: #95a5a6;
            text-transform: uppercase;
            display: block;
            margin-bottom: 3px;
        }

        .sense-txt {
            font-size: 8.5pt;
            color: #444;
            line-height: 1.4;
            text-align: justify;
        }

        /* ==========================================================================
           M√ìDULO 4 - MEM√ìRIAS (ESTILO CORRIGIDO)
           ========================================================================== */
        
        .mem-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-content: flex-start;
            gap: 15px;
        }

        /* CARD DE GR√ÅFICO (BARRA) */
        .mem-container {
            width: 48%;
            margin-bottom: 15px;
            page-break-inside: avoid;
        }

        .mem-label-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .mem-title {
            font-size: 7.5pt;
            font-weight: 800;
            color: #2c3e50;
            text-transform: uppercase;
        }

        .mem-val {
            font-size: 8pt;
            font-weight: 700;
            color: #555;
        }

        .mem-track {
            height: 10px;
            background: #eee;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 2px;
        }

        .mem-fill {
            height: 100%;
            border-radius: 5px;
        }

        .mem-scale {
            display: flex;
            justify-content: space-between;
            font-size: 6pt;
            color: #aaa;
            padding: 0 2px;
            font-family: monospace;
        }

        .mem-epi .mem-fill { background: #8e44ad; }
        .mem-imp .mem-fill { background: #2c3e50; }

        /* COMENT√ÅRIO DE A√á√ÉO (ABAIXO DA BARRA) */
        .mem-action-comment {
            font-size: 7pt;
            color: #e67e22;
            font-weight: 600;
            font-style: italic;
            margin-top: 4px;
            padding-top: 2px;
            border-top: 1px dotted #ccc;
            line-height: 1.2;
        }

        /* CARD DE TEXTO (RELATOS - P√ÅGINA SEGUINTE) */
        .mem-text-box {
            width: 100%;
            margin-bottom: 12px;
            background: #fdfdfd;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #2c3e50;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .mem-text-label {
            font-size: 8pt;
            font-weight: 800;
            color: #2c3e50;
            text-transform: uppercase;
            display: block;
            margin-bottom: 5px;
        }

        .mem-text-val {
            font-size: 9.5pt;
            font-style: italic;
            color: #555;
            line-height: 1.5;
        }

        /* ==========================================================================
           M√ìDULO 5 - ATUAL (ESTILO ENRIQUECIDO)
           ========================================================================== */
        
        .sensory-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .sb-lbl {
            width: 100px;
            font-size: 8pt;
            font-weight: 700;
            text-align: right;
            margin-right: 10px;
        }

        .sb-track {
            flex: 1;
            height: 6px;
            background: #eee;
            border-radius: 3px;
            overflow: hidden;
        }

        .sb-fill {
            height: 100%;
            background: #2c3e50;
        }

        .sb-val {
            width: 30px;
            font-size: 8pt;
            font-weight: 700;
            margin-left: 10px;
        }

        .check-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .ct-item {
            background: #f0f2f5;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 9pt;
            font-weight: 600;
            color: #555;
            border: 1px solid #ddd;
        }

        /* INSIGHT BOX (ABAIXO DOS GRIDS) */
        .insight-box {
            background: #eafaf1;
            border: 1px solid #d5f5e3;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            font-size: 8.5pt;
            color: #27ae60;
            font-style: italic;
            line-height: 1.3;
        }

        /* MATRIZ */
        .matrix-box {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .matrix-title {
            font-size: 9pt;
            font-weight: 800;
            color: #2c3e50;
            text-transform: uppercase;
            margin-bottom: 8px;
            border-bottom: 1px solid #eee;
            padding-bottom: 4px;
        }

        .matrix-content {
            font-size: 9pt;
            color: #555;
            line-height: 1.5;
        }

        /* CORES UTILIT√ÅRIAS */
        .c-fogo { color: #e74c3c; } .bg-fogo { background: #e74c3c; }
        .c-ar { color: #3498db; } .bg-ar { background: #3498db; }
        .c-agua { color: #2980b9; } .bg-agua { background: #2980b9; }
        .c-terra { color: #27ae60; } .bg-terra { background: #27ae60; }
        
        .s-vis { color: #f39c12; } .bg-vis { background: #f39c12; border-color: #f39c12; }
        .s-aud { color: #9b59b6; } .bg-aud { background: #9b59b6; border-color: #9b59b6; }
        .s-olf { color: #27ae60; } .bg-olf { background: #27ae60; border-color: #27ae60; }
        .s-tat { color: #e67e22; } .bg-tat { background: #e67e22; border-color: #e67e22; }
        .s-prop { color: #c0392b; } .bg-prop { background: #c0392b; border-color: #c0392b; }
        .s-gus { color: #e84393; } .bg-gus { background: #e84393; border-color: #e84393; }
        .s-emo { color: #8e44ad; } .bg-emo { background: #8e44ad; border-color: #8e44ad; }
        .s-cog { color: #2980b9; } .bg-cog { background: #2980b9; border-color: #2980b9; }
    </style>
</head>
<body>

    <div class="painel">
        <div class="header-painel">
            <div class="hp-title">Dashboard NeuroBriefing</div>
            <button class="btn-refresh" onclick="location.reload()">üîÑ Atualizar Dados</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th style="width: 100px;">Data</th>
                    <th style="width: 30%;">Cliente</th>
                    <th style="width: 20%;">Respons√°vel</th>
                    <th>Status</th>
                    <th style="text-align:right;">A√ß√£o</th>
                </tr>
            </thead>
            <tbody id="lista"><tr><td colspan="5">Carregando dados...</td></tr></tbody>
        </table>
    </div>

    <div id="pdf-root">
        
        <div class="page">
            <div class="capa-box">
                <div class="c-logo">NEUROBRIEFING</div>
                <div class="c-sub">Diagn√≥stico Integral & Estrat√©gia</div>
                <div class="c-info">
                    <span class="ci-lbl">Cliente Analisado</span><span class="ci-val" id="cp-nome">-</span>
                    <span class="ci-lbl">Arquiteto Respons√°vel</span><span class="ci-val" id="cp-arq">-</span>
                    <span class="ci-lbl">Data do Diagn√≥stico</span><span class="ci-val" id="cp-data">-</span>
                </div>
                <div class="c-foot">Documento Confidencial de Uso Profissional</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div><div class="mh-tit">IDENTIDADE DO SER</div><div class="mh-sub">Arqu√©tipo & Temperamento</div></div>
                    <div class="mh-meta"><div class="mh-num">01</div><span class="mh-time" id="t1-time">--:--</span></div>
                </div>
                <div class="charts" id="chart-container"></div>
                <div class="win-box">
                    <div class="wb-head" id="wb-head"><div class="wb-tit" id="txt-el">-</div><div class="wb-sty" id="txt-tit">-</div></div>
                    <div class="wb-body" id="m1-content"></div>
                </div>
                <div class="strategy-grid">
                    <div class="st-card"><div class="st-head">üß† NEUROARQUITETURA (BASE)</div><div class="st-text" id="m1-neuro-individual"></div></div>
                    <div class="st-card"><div class="st-head">üó£Ô∏è ATENDIMENTO (BASE)</div><div class="st-text" id="m1-comunicacao-individual"></div></div>
                </div>
                <div class="strategy-grid">
                    <div class="st-card highlight"><div class="st-head">üëë PERFIL COMBINADO (DOM + SEC)</div><div class="st-text" id="m1-perfil-texto"></div><div class="st-text" id="m1-projeto-texto" style="margin-top:8px; font-weight:bold;"></div></div>
                    <div class="st-card shadow-card"><div class="st-head">‚ö†Ô∏è PONTO DE ATEN√á√ÉO (SOMBRA)</div><div class="st-text" id="m1-sombra-texto"></div><div class="st-text" id="m1-comunicacao-texto" style="margin-top:8px; font-style:italic;"></div></div>
                </div>
                <div class="box-conclusao">
                    <span class="bc-tit">DIRETRIZ PROJETUAL (M√ìDULO 1)</span>
                    O perfil identificado exige uma estrat√©gia de design que respeite a "Energia Base". A neuroarquitetura sugere alinhar a complexidade visual ao n√≠vel de est√≠mulo que este c√©rebro suporta.
                </div>
                <div class="ft-note">NeuroBriefing Intelligence</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div><div class="mh-tit">IDENTIDADE VISUAL</div><div class="mh-sub">Parte A: Estilo & DNA Visual</div></div>
                    <div class="mh-meta"><div class="mh-num">02</div><span class="mh-time" id="t2-time">--:--</span></div>
                </div>
                <div class="win-box" style="flex:0 auto; margin-bottom:20px;">
                    <div class="wb-head" style="background:#2c3e50;">
                        <div class="wb-tit">ESTILO PREDOMINANTE</div>
                        <div class="wb-sty" style="color:#f1c40f;">MATCH PRINCIPAL</div>
                    </div>
                    <div class="wb-body" style="padding:20px; text-align:center;">
                        <h2 style="margin:0; font-size:24pt; color:#2c3e50; text-transform:uppercase;" id="vis-top1-nome">-</h2>
                        <div style="margin-top:10px; font-size:12pt; font-weight:bold; color:#27ae60;">AFINIDADE: <span id="vis-top1-nota">-</span>%</div>
                    </div>
                </div>
                <div id="m2-content"></div>
                <div class="win-box">
                    <div class="wb-head" style="background:#7f8c8d;"><div class="wb-tit">DNA VISUAL</div></div>
                    <div class="wb-body" id="m2-dna-content"></div>
                </div>
                <div class="ft-note">NeuroBriefing Intelligence - Continua na pr√≥xima p√°gina...</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div><div class="mh-tit">IDENTIDADE VISUAL</div><div class="mh-sub">Parte B: Protocolo T√©cnico</div></div>
                    <div class="mh-meta"><div class="mh-num">02</div><span class="mh-time" style="color:#aaa;">CONTINUA√á√ÉO</span></div>
                </div>
                <div class="grid-2">
                    <div class="win-box col">
                        <div class="wb-head" style="background:#27ae60;"><div class="wb-tit">MANDAT√ìRIOS (DO's)</div></div>
                        <div class="wb-body" id="m2-mandatory"></div>
                    </div>
                    <div class="win-box col">
                        <div class="wb-head" style="background:#e74c3c;"><div class="wb-tit">EVITAR (DON'Ts)</div></div>
                        <div class="wb-body" id="m2-avoid"></div>
                    </div>
                </div>
                <div class="win-box">
                    <div class="wb-head" style="background:#f39c12;"><div class="wb-tit">ILUMINA√á√ÉO & ATMOSFERA</div></div>
                    <div class="wb-body" id="m2-lighting"></div>
                </div>
                <div class="box-conclusao">
                    <span class="bc-tit">CONCLUS√ÉO T√âCNICA (VISUAL)</span>
                    <span id="m2-conclusao-dinamica">Siga os mandat√≥rios para garantir a coer√™ncia estil√≠stica.</span>
                </div>
                <div class="ft-note">NeuroBriefing Intelligence</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div><div class="mh-tit">IDENTIDADE SENSORIAL</div><div class="mh-sub">Parte A: Sentidos F√≠sicos & Ambientais</div></div>
                    <div class="mh-meta"><div class="mh-num">03</div><span class="mh-time" id="t3-time">--:--</span></div>
                </div>
                <div class="sensory-page-grid" id="m3-grid-part-a">
                    </div>
                <div class="box-conclusao">
                    <span class="bc-tit">ESTRAT√âGIA DE CONFORTO AMBIENTAL</span>
                    Estes sentidos (Visual, Auditivo, Olfativo, T√°til) formam a base biol√≥gica do bem-estar. Se houver pontua√ß√£o extrema (0-20 ou 80-100), a interven√ß√£o t√©cnica (isolamento, ilumina√ß√£o) √© obrigat√≥ria.
                </div>
                <div class="ft-note">NeuroBriefing Intelligence - Continua na pr√≥xima p√°gina...</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div><div class="mh-tit">IDENTIDADE SENSORIAL</div><div class="mh-sub">Parte B: Sentidos Complexos & Cogni√ß√£o</div></div>
                    <div class="mh-meta"><div class="mh-num">03</div><span class="mh-time" style="color:#aaa;">CONTINUA√á√ÉO</span></div>
                </div>
                <div class="sensory-page-grid" id="m3-grid-part-b">
                    </div>
                <div class="box-conclusao">
                    <span class="bc-tit">ESTRAT√âGIA DE EXPERI√äNCIA DO USU√ÅRIO</span>
                    Estes sentidos definem a usabilidade e a conex√£o emocional. O Proprioceptivo define a escala; o Emocional dita as "√¢ncoras" afetivas.
                </div>
                <div class="ft-note">NeuroBriefing Intelligence</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div><div class="mh-tit">IDENTIDADE MEM√ìRIAS</div><div class="mh-sub">Parte A: Mapeamento de Mem√≥rias</div></div>
                    <div class="mh-meta"><div class="mh-num">04</div><span class="mh-time" id="t4-time">--:--</span></div>
                </div>
                <div class="win-box">
                    <div class="wb-head" style="background:#8e44ad;"><div class="wb-tit">MEM√ìRIA EXPL√çCITA (CONSCIENTE)</div><div class="wb-sty">O QUE ELE DIZ</div></div>
                    <div class="wb-body" id="m4-expl-graficos" class="mem-grid"></div>
                </div>
                <div class="win-box">
                    <div class="wb-head" style="background:#2c3e50;"><div class="wb-tit">MEM√ìRIA IMPL√çCITA (INCONSCIENTE)</div><div class="wb-sty">O QUE ELE SENTE/FAZ</div></div>
                    <div class="wb-body" id="m4-impl-graficos" class="mem-grid"></div>
                </div>
                <div class="ft-note">NeuroBriefing Intelligence - Continua na pr√≥xima p√°gina...</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div><div class="mh-tit">IDENTIDADE MEM√ìRIAS</div><div class="mh-sub">Parte B: Relatos & Estrat√©gia</div></div>
                    <div class="mh-meta"><div class="mh-num">04</div><span class="mh-time" style="color:#aaa;">CONTINUA√á√ÉO</span></div>
                </div>
                <div class="win-box" style="margin-bottom:20px;">
                    <div class="wb-head" style="background:#7f8c8d;"><div class="wb-tit">RELATOS IMPORTANTES</div></div>
                    <div class="wb-body" id="m4-textos"></div>
                </div>
                <div class="strategy-grid">
                    <div class="st-card"><div class="st-head">‚è≥ V√çNCULO TEMPORAL</div><div class="st-text" id="m4-vinculo">...</div></div>
                    <div class="st-card highlight"><div class="st-head">üîë ESTRAT√âGIA DE ANCORAGEM</div><div class="st-text" id="m4-ancoragem">...</div></div>
                </div>
                <div class="box-conclusao" style="margin-top:auto;">
                    <span class="bc-tit">CONCLUS√ÉO ESTRAT√âGICA</span>
                    <span id="m4-conclusao-dinamica">A casa deve ser um espelho da biografia do cliente.</span>
                </div>
                <div class="ft-note">NeuroBriefing Intelligence</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div><div class="mh-tit">IDENTIDADE ATUAL</div><div class="mh-sub">Parte A: Estilo de Vida & Implica√ß√µes</div></div>
                    <div class="mh-meta"><div class="mh-num">05</div><span class="mh-time" id="t5-time">--:--</span></div>
                </div>
                <div class="grid-2">
                    <div class="win-box col">
                        <div class="wb-head" style="background:#2980b9;"><div class="wb-tit">FASE DE VIDA</div></div>
                        <div class="wb-body">
                            <div class="check-tags" id="m5-fase"></div>
                            <div class="insight-box" id="m5-fase-insight"></div>
                        </div>
                    </div>
                    <div class="win-box col">
                        <div class="wb-head" style="background:#27ae60;"><div class="wb-tit">INVESTIMENTO</div></div>
                        <div class="wb-body">
                            <div class="check-tags" id="m5-invest"></div>
                            <div class="insight-box" id="m5-invest-insight"></div>
                        </div>
                    </div>
                </div>
                <div class="win-box">
                    <div class="wb-head" style="background:#e67e22;"><div class="wb-tit">HOBBIES & RITUAIS</div></div>
                    <div class="wb-body">
                        <div class="check-tags" id="m5-hobbies"></div>
                    </div>
                </div>
                <div class="ft-note">NeuroBriefing Intelligence - Continua na pr√≥xima p√°gina...</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div><div class="mh-tit">IDENTIDADE ATUAL</div><div class="mh-sub">Parte B: Matriz de Decis√£o</div></div>
                    <div class="mh-meta"><div class="mh-num">05</div><span class="mh-time" style="color:#aaa;">CONTINUA√á√ÉO</span></div>
                </div>
                <div class="win-box"><div class="wb-head" style="background:#34495e;"><div class="wb-tit">PERSONALIDADE & EXPECTATIVA</div></div><div class="wb-body">
                    <div style="margin-bottom:15px;"><span class="il-lbl">TRA√áOS DE PERSONALIDADE:</span><div class="check-tags" id="m5-pers"></div></div>
                    <div><span class="il-lbl">EXPECTATIVA DE MORADIA (TEMPO):</span><div class="sensory-bar" style="margin-top:5px;"><span class="sb-lbl" style="width:auto; margin-right:10px;">Provis√≥rio</span><div class="sb-track" style="margin:0 10px;"><div class="sb-fill" id="m5-tempo-bar" style="width:50%; background:#e67e22;"></div></div><span class="sb-val" style="width:auto; margin-left:10px;">Eterno</span></div><div style="text-align:center; font-size:9pt; font-weight:bold; color:#e67e22;" id="m5-tempo-val">50%</div></div>
                </div></div>
                <div class="strategy-grid">
                    <div class="st-card shadow-card"><div class="st-head">üí∞ MATRIZ DE INVESTIMENTO INTELIGENTE</div><div class="st-text" id="m5-invest-matrix">...</div></div>
                    <div class="st-card"><div class="st-head">üîÑ PLANO DE A√á√ÉO (HOBBIES)</div><div class="st-text" id="m5-ritual-tips" style="font-size:8.5pt;"></div></div>
                </div>
                <div class="win-box"><div class="wb-head" style="background:#7f8c8d;"><div class="wb-tit">OBSERVA√á√ïES GERAIS</div></div><div class="wb-body" style="font-style:italic; color:#555;" id="m5-obs">-</div></div>
                <div class="box-conclusao"><span class="bc-tit">CONCLUS√ÉO FINAL</span>Baseado em Roger Barker, o design deve sustentar os comportamentos. O alinhamento do budget com a expectativa de tempo define a materialidade.</div>
                <div class="ft-note">NeuroBriefing Intelligence</div>
            </div>
        </div>

    </div>

    <script>
        // 1. DADOS MOD 1 e 2
        const DB = {
            FOGO: { 
                id:'FOGO', cor:'#e74c3c', class:'fogo', titulo:'Executor (Col√©rico)', 
                energia:'A√ß√£o ¬∑ Dire√ß√£o ¬∑ Intensidade', quem:'Pessoas focadas em resultados e agilidade.', 
                perfil:'Executor', estilos:['Contempor√¢neo', 'Industrial', 'High Tech'], 
                neuro: 'Este c√©rebro busca <strong>dopamina</strong> (recompensa r√°pida). O projeto deve ter <strong>fluxos livres</strong>, ilumina√ß√£o clara e setoriza√ß√£o eficiente.', 
                comunicacao: 'Seja <strong>objetivo e direto</strong>. N√£o d√™ voltas. Foque em prazos, solu√ß√µes t√©cnicas e efici√™ncia.' 
            },
            AR: { 
                id:'AR', cor:'#3498db', class:'ar', titulo:'Comunicador (Sangu√≠neo)', 
                energia:'Express√£o ¬∑ Conex√£o ¬∑ Novidade', quem:'Pessoas soci√°veis e visuais.', 
                perfil:'Comunicador', estilos:['Boho Chic', 'Ecl√©tico', 'Maximalismo'], 
                neuro: 'Busca <strong>est√≠mulos variados</strong>. O projeto precisa de √°reas de conviv√™ncia e flexibilidade.', 
                comunicacao: 'Seja <strong>entusiasta e visual</strong>. Use muitas imagens e refer√™ncias.' 
            },
            AGUA: { 
                id:'√ÅGUA', cor:'#2980b9', class:'agua', titulo:'Planejador (Fleum√°tico)', 
                energia:'Acolhimento ¬∑ Calma', quem:'Pessoas diplom√°ticas.', 
                perfil:'Planejador', estilos:['Japandi', 'Org√¢nico', 'Wabi-Sabi'], 
                neuro: 'Busca <strong>seguran√ßa e ocitocina</strong>. Priorize ac√∫stica e texturas t√°teis macias.', 
                comunicacao: 'Seja <strong>paciente</strong>. Transmita seguran√ßa.' 
            },
            TERRA: { 
                id:'TERRA', cor:'#27ae60', class:'terra', titulo:'Analista (Melanc√≥lico)', 
                energia:'Estrutura ¬∑ Ordem', quem:'Pessoas met√≥dicas.', 
                perfil:'Analista', estilos:['Cl√°ssico', 'Minimalismo'], 
                neuro: 'Busca <strong>previsibilidade</strong>. Simetria e arm√°rios fechados.', 
                comunicacao: 'Seja <strong>detalhista</strong>. Mostre cronogramas.' 
            }
        };
        const DB_VISUAL = {
            'est_contemp': 'Contempor√¢neo', 'est_ind': 'Industrial', 'est_urb': 'Moderno Urbano', 'est_tech': 'High Tech', 'est_luxo': 'Luxo Moderno',
            'est_scandi': 'Escandinavo', 'est_cont_leve': 'Contempor√¢neo Leve', 'est_boho': 'Boho Chic', 'est_japandi': 'Japandi', 'est_wabi': 'Wabi-Sabi',
            'est_organico': 'Org√¢nico', 'est_coastal': 'Coastal', 'est_natural': 'Natural Chic',
            'est_mid': 'Mid-Century', 'est_ecletico': 'Ecl√©tico', 'est_classico': 'Cl√°ssico', 'est_neoclass': 'Neocl√°ssico',
            'est_trad': 'Tradicional Contempor√¢neo', 'est_mod_eleg': 'Moderno Elegante', 'est_colonial': 'Colonial Atualizado'
        };
        const DB_VISUAL_DETAILS = {
            'est_tech': { conceito: 'Futurismo e automa√ß√£o.', materiais: 'Vidro, A√ßo, High-Gloss.', luz: 'Linear, RGB, Fria.', mobiliario: 'Design ergon√¥mico.', neuro: 'Reduz carga cognitiva pela limpeza. Automa√ß√£o gera controle.' },
            'est_scandi': { conceito: 'Hygge: Conforto e luz.', materiais: 'Madeira clara, L√£.', luz: 'Ampla, Natural, Quente.', mobiliario: 'P√©s palito, sof√°s cinza.', neuro: 'Promove calma. Madeira clara reduz press√£o arterial.' },
            'est_ind': { conceito: 'Estrutura aparente.', materiais: 'Tijolo, Concreto, Metal.', luz: 'Trilhos, Filamento.', mobiliario: 'Couro, ferro.', neuro: 'Estimula criatividade e liberdade.' },
            'est_contemp': { conceito: 'O "agora". Conforto atual.', materiais: 'Mix de texturas.', luz: 'Vers√°til, sancas.', mobiliario: 'Linhas horizontais.', neuro: 'Equil√≠brio e atualiza√ß√£o.' },
            'est_trad': { conceito: 'Conforto familiar.', materiais: 'Madeira escura, tecidos.', luz: 'Abajures, quente.', mobiliario: 'Pe√ßas robustas.', neuro: 'Evoca mem√≥rias afetivas (Raiz).' },
            'est_classico': { conceito: 'Simetria, propor√ß√£o.', materiais: 'M√°rmore, Boiserie.', luz: 'Lustres de cristal.', mobiliario: 'Antiguidades.', neuro: 'A simetria reduz o esfor√ßo cognitivo e gera prazer est√©tico.' },
            'est_japandi': { conceito: 'Funcionalidade + Rusticidade.', materiais: 'Bambu, Cer√¢mica.', luz: 'Baixa, sombras intencionais.', mobiliario: 'Baixo, linhas retas.', neuro: 'Redu√ß√£o dr√°stica de ru√≠do visual para foco e paz.' },
            'est_boho': { conceito: 'Alma livre, viagens.', materiais: 'Macram√™, Rattan, Plantas.', luz: 'Cord√£o de luzes, velas.', mobiliario: 'Garimpo.', neuro: 'Estimula a curiosidade e a conex√£o emocional.' },
            'est_luxo': { conceito: 'Sofistica√ß√£o e brilho.', materiais: 'Metais nobres, Espelhos.', luz: 'C√™nica, pendentes.', mobiliario: 'Design italiano.', neuro: 'Valida√ß√£o de status e conquista (Serotonina).' },
            'default': { conceito: 'Estilo personalizado.', materiais: 'Equil√≠brio de texturas.', luz: 'Foco em camadas.', mobiliario: 'Prioridade para ergonomia.', neuro: 'Reflete a autoimagem do cliente.' }
        };
        const CORRELACOES = {
            'FOGO_TERRA': { perfil: 'O CONSTRUTOR: Pragm√°tico e ambicioso.', projeto: 'Solidez e Status. Materiais nobres.', atendimento: 'Seja t√©cnico e pontual.' },
            'FOGO_AR': { perfil: 'O INOVADOR: Din√¢mico e criativo.', projeto: 'Impacto Visual ("Uau") e Automa√ß√£o.', atendimento: 'Seja √°gil, visual e venda a novidade.' },
            'FOGO_AGUA': { perfil: 'O PROTETOR: Intenso e emotivo.', projeto: 'Ref√∫gio Seguro e robusto.', atendimento: 'V√≠nculo emocional r√°pido.' },
            'AR_FOGO': { perfil: 'O CRIATIVO: Mente acelerada.', projeto: 'Liberdade e Cor.', atendimento: 'Brainstorming e ritmo.' },
            'AR_TERRA': { perfil: 'O DESIGNER: Bom gosto racional.', projeto: 'Est√©tica Funcional.', atendimento: 'Explique o porqu√™ est√©tico.' },
            'AR_AGUA': { perfil: 'O ANFITRI√ÉO: Social e emp√°tico.', projeto: 'Experi√™ncia Sensorial.', atendimento: 'Foque no bem-estar.' },
            'TERRA_FOGO': { perfil: 'O ESTRATEGISTA: Controlador.', projeto: 'Efici√™ncia M√°xima.', atendimento: 'Mostre controle total.' },
            'TERRA_AR': { perfil: 'O CURADOR: Culto e detalhista.', projeto: 'Galeria Habit√°vel.', atendimento: 'Demonstre cultura.' },
            'TERRA_AGUA': { perfil: 'O GUARDI√ÉO: Conservador.', projeto: 'Tradi√ß√£o e conforto.', atendimento: 'Transmita seguran√ßa.' },
            'AGUA_FOGO': { perfil: 'O INTUITIVO: Guiado pelo feeling.', projeto: 'Personalidade e alma.', atendimento: 'Conecte-se primeiro.' },
            'AGUA_AR': { perfil: 'O SONHADOR: Sens√≠vel.', projeto: 'Leveza e tons past√©is.', atendimento: 'Seja delicado.' },
            'AGUA_TERRA': { perfil: 'O ACOLHEDOR: Fam√≠lia.', projeto: 'Ninho e cozinha grande.', atendimento: 'Seja previs√≠vel.' }
        };
        const SOMBRAS = {
            'FOGO': 'Falta paci√™ncia. Manuten√ß√£o zero.',
            'AR': 'Falta foco. Evite excesso visual.',
            'TERRA': 'Falta flexibilidade. Prove a ordem.',
            'AGUA': 'Falta praticidade. Priorize uso.'
        };
        const DB_MEMORY_STRATEGIES = {
            'mem_epi_infancia': "<strong>Estrat√©gia Inf√¢ncia:</strong> A inf√¢ncia √© o porto seguro. Reinterprete elementos da casa dos pais (ex: piso de taco, cheiro de bolo).",
            'mem_epi_viagem': "<strong>Estrat√©gia Cosmopolita:</strong> O projeto deve ser um di√°rio de viagens, expondo souvenirs, mapas e arte global.",
            'mem_epi_aconchego': "<strong>Estrat√©gia Ninho:</strong> Busca prote√ß√£o. Crie 'cantos de ref√∫gio' com mantas, luz baixa (2700K) e cores quentes.",
            'mem_epi_lar': "<strong>Estrat√©gia Fam√≠lia:</strong> Foco na conviv√™ncia. A mesa de jantar e o sof√° s√£o os protagonistas da casa.",
            'mem_proc_bagunca': "<strong>Estrat√©gia Realista:</strong> A 'bagun√ßa criativa' faz parte do processo. N√£o force minimalismo extremo. Crie organizadores abertos.",
            'mem_proc_fluxo': "<strong>Estrat√©gia Efici√™ncia:</strong> Valoriza a agilidade. O layout deve ser intuitivo, sem obst√°culos no caminho.",
            'default': "<strong>Estrat√©gia Biogr√°fica:</strong> A casa deve contar a hist√≥ria do morador atrav√©s de objetos significativos e layout fluido."
        };
        const DB_LIFESTYLE = {
            'curto_prazo': "Foco em <strong>Revenda e Liquidez</strong>. Use materiais neutros e invista em mobili√°rio solto de qualidade que possa ser levado.",
            'longo_prazo': "Foco em <strong>Longevidade e Personaliza√ß√£o</strong>. Invista pesado em infraestrutura, automa√ß√£o e marcenaria sob medida.",
            'economico': "Priorize o <strong>Custo-Benef√≠cio</strong>. Use pintura criativa e ilumina√ß√£o para dar efeito sem gastar em revestimentos caros.",
            'luxo': "Priorize a <strong>Exclusividade</strong>. Materiais naturais e pe√ßas assinadas s√£o obrigat√≥rios.",
            'default': "Equil√≠brio entre fun√ß√£o e est√©tica."
        };

        // --- DADOS EXPERT M√ìDULO 2B (V58) ---
        const DB_VISUAL_EXTENDED = {
            'est_contemp': {
                dna: { cores: ['#D3D3D3', '#FFFFFF', '#333333'], formas: 'Linhas retas e puras', texturas: 'Lisos e foscos' },
                mandatorios: ['Ilumina√ß√£o natural abundante', 'Mobili√°rio de design assinado', 'Paleta neutra com pontos de cor'],
                evitar: ['Excesso de ornamentos', 'Estampas florais antigas', 'M√≥veis rococ√≥'],
                luz: 'Luz geral difusa (4000K) + Pontos de destaque (3000K). Evite luz fria no estar.'
            },
            'est_ind': {
                dna: { cores: ['#808080', '#000000', '#8B4513'], formas: 'Estruturais e brutas', texturas: 'Concreto, Tijolo, Metal' },
                mandatorios: ['Tubula√ß√£o aparente', 'Materiais crus (sem acabamento)', 'P√© direito alto se poss√≠vel'],
                evitar: ['Acabamentos muito polidos', 'Cores pastel', 'Cortinas de renda'],
                luz: 'Trilhos de spots pretos. L√¢mpadas de filamento (2200K) s√£o essenciais.'
            },
            'default': {
                dna: { cores: ['#EEE', '#CCC', '#999'], formas: 'Variadas', texturas: 'Mistas' },
                mandatorios: ['Coer√™ncia visual', 'Ergonomia', 'Propor√ß√£o'],
                evitar: ['Excesso de informa√ß√£o', 'Fluxos bloqueados'],
                luz: 'Luz quente para conforto (2700-3000K).'
            }
        };

        // --- DADOS EXPERT M√ìDULO 3 (EXPANDIDO PARA 8 SENSORES) ---
        const DB_SENSORY_EXPERT = {
            'vis': { 
                title: '3.1 VISUAL', icon: 'üëÅÔ∏è', color: 's-vis', border: 'bg-vis', key: 'vis_complex', 
                getStrat: (val) => {
                    if (val > 75) return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Alta demanda visual. C√©rebro busca complexidade para n√£o entediar.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Ilumina√ß√£o em camadas, pontos focais, mix de estampas controladas.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-txt">Est√≠mulo Dopamin√©rgico.</div></div>`;
                    return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Prefere Minimalismo. Excesso gera estresse.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Oculte bagun√ßa, use cores neutras e superf√≠cies limpas.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Descanso Cognitivo.</div></div>`;
                }
            },
            'aud': { 
                title: '3.2 AUDITIVO', icon: 'üëÇ', color: 's-aud', border: 'bg-aud', key: 'aud_eco', 
                getStrat: (val) => {
                    if (val < 30) return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Hipersensibilidade. Ru√≠do = Cortisol.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">OBRIGAT√ìRIO: Pain√©is ac√∫sticos, tapetes densos, veda√ß√£o.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Prote√ß√£o da Am√≠gdala.</div></div>`;
                    return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Tolerante a ru√≠dos.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Integra√ß√£o total e pisos frios (cer√¢mica/pedra).</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Conex√£o Social.</div></div>`;
                }
            },
            'olf': { 
                title: '3.3 OLFATIVO', icon: 'üëÉ', color: 's-olf', border: 'bg-olf', key: 'olf_sens', 
                getStrat: (val) => {
                    if (val > 70) return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Olfato apurado e emocional.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Scent Design, ventila√ß√£o cruzada, materiais inodoros.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Acesso direto ao Sistema L√≠mbico.</div></div>`;
                    return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Neutro.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Foco em ar fresco e higiene.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Sa√∫de b√°sica.</div></div>`;
                }
            },
            'tat': { 
                title: '3.4 T√ÅTIL', icon: '‚úã', color: 's-tat', border: 'bg-tat', key: 'tat_tex_macia', 
                getStrat: (val) => {
                    if (val > 60) return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Necessidade H√°pica (Toque).</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Madeira natural, linho, veludo, tapetes altos.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Libera√ß√£o de Ocitocina.</div></div>`;
                    return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Prefere lisura e limpeza.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Vidro, metal, porcelanato polido.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Seguran√ßa sanit√°ria.</div></div>`;
                }
            },
            'prop': { 
                title: '3.5 PROPRIOCEPTIVO', icon: 'üß≠', color: 's-prop', border: 'bg-prop', key: 'prop_pe_dir', 
                getStrat: (val) => {
                    if (val > 50) return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Prospecto (Dom√≠nio).</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">P√© direito alto, vistas livres, circula√ß√£o larga.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Poder e Liberdade.</div></div>`;
                    return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Ref√∫gio (Abra√ßo).</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Tetos baixos, cantos de leitura, 'tocas'.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Prote√ß√£o primitiva.</div></div>`;
                }
            },
            'gus': { 
                title: '3.6 GUSTATIVO', icon: 'üçΩÔ∏è', color: 's-gus', border: 'bg-gus', key: 'gus_social', 
                getStrat: (val) => {
                    if (val > 50) return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Comensalidade Social.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Ilha gourmet, luz quente (3000K) sobre a mesa.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Est√≠mulo multissensorial.</div></div>`;
                    return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Nutri√ß√£o Funcional.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Cozinha laborat√≥rio, foco na limpeza.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Efici√™ncia.</div></div>`;
                }
            },
            'emo': { 
                title: '3.7 EMOCIONAL', icon: '‚ù§Ô∏è', color: 's-emo', border: 'bg-emo', key: 'emo_nostalgia', 
                getStrat: (val) => {
                    if (val > 50) return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Nostalgia e Ra√≠zes.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Expor heran√ßas, fotos e objetos com hist√≥ria.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Identidade do Self.</div></div>`;
                    return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Renova√ß√£o e Futuro.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Design limpo, novo, sem apegos.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Plasticidade cerebral.</div></div>`;
                }
            },
            'cog': { 
                title: '3.8 COGNITIVO', icon: 'üß†', color: 's-cog', border: 'bg-cog', key: 'cog_prod', 
                getStrat: (val) => {
                    if (val < 50) return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Foco Fr√°gil.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO PROJETUAL:</span><div class="sense-txt">Home Office fechado, paredes lisas √† frente.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Gest√£o da Aten√ß√£o.</div></div>`;
                    return `<div class="sense-section"><span class="sense-lbl">DIAGN√ìSTICO:</span><div class="sense-txt">Multitarefa.</div></div><div class="sense-section"><span class="sense-lbl">A√á√ÉO:</span><div class="sense-txt">Integra√ß√£o trabalho-lazer permitida.</div></div><div class="sense-section"><span class="sense-lbl">NEURO-LINK:</span><div class="sense-text">Flexibilidade.</div></div>`;
                }
            }
        };

        // --- COMENT√ÅRIOS E A√á√ïES PARA O M√ìDULO 4 (V55) ---
        const DB_MEM_ACTIONS = {
            'INFANCIA': { high: "Evocar seguran√ßa emocional. Use materiais quentes e layout acolhedor.", low: "Foco no presente. Design moderno e desapegado do passado." },
            'VIAGEM': { high: "Espa√ßo para mem√≥rias. Estantes para souvenirs e mapas.", low: "Decora√ß√£o local e enraizada." },
            'ACONCHEGO': { high: "Criar ref√∫gios. Ilumina√ß√£o 2700K e t√™xteis macios.", low: "Espa√ßos amplos e arejados." },
            'LAR': { high: "Centro da vida social. Cozinha e estar integrados.", low: "Casa funcional para descanso r√°pido." },
            'BAGUNCA': { high: "Prever 'zonas de caos' organizadas (cestos, gavet√µes).", low: "Minimalismo extremo. Tudo embutido." },
            'FLUXO': { high: "Circula√ß√£o livre e desimpedida.", low: "Ambientes compartimentados e definidos." },
            'AZUL': { high: "Uso de cores frias para calma e foco.", low: "Prefer√™ncia por tons terrosos e quentes." },
            'MADEIRA': { high: "Biofilia e textura natural obrigat√≥rias.", low: "Materiais sint√©ticos e pr√°ticos." },
            'METAL': { high: "Estilo industrial e moderno.", low: "Evitar frieza. Usar tecidos." },
            'TEC': { high: "Automa√ß√£o total (luz, som, cortinas).", low: "Sistemas manuais e simples." },
            'default': { high: "Alta relev√¢ncia para o projeto.", low: "Baixa relev√¢ncia para o projeto." }
        };

        // --- INSIGHTS PARA O M√ìDULO 5A (V58) ---
        const DB_PHASE_INSIGHTS = {
            'Crian√ßas': "<strong>Insight Arquitet√¥nico:</strong> Priorize seguran√ßa (cantos arredondados, prote√ß√£o de tomadas) e materiais lav√°veis. Crie zonas de 'bagun√ßa controlada'.",
            'Adolescentes': "<strong>Insight Arquitet√¥nico:</strong> Foco em privacidade e identidade. Preveja isolamento ac√∫stico refor√ßado e espa√ßos personaliz√°veis.",
            'Idosos': "<strong>Insight Arquitet√¥nico:</strong> Acessibilidade universal (barras de apoio discretas, piso antiderrapante, ilumina√ß√£o de balizamento).",
            'Casal': "<strong>Insight Arquitet√¥nico:</strong> Equil√≠brio entre intimidade e conviv√™ncia. Banheiros setorizados e isolamento ac√∫stico na su√≠te.",
            'Solteiro': "<strong>Insight Arquitet√¥nico:</strong> Otimiza√ß√£o e praticidade. Integra√ß√£o total para ampliar a sensa√ß√£o de espa√ßo."
        };
        
        const DB_INVEST_INSIGHTS = {
            'Econ√¥mico': "<strong>Estrat√©gia:</strong> Foque em pintura criativa e ilumina√ß√£o c√™nica. Use m√≥veis soltos que podem ser reaproveitados.",
            'M√©dio': "<strong>Estrat√©gia:</strong> Invista em marcenaria fixa nas √°reas molhadas e piso de alta qualidade nas √°reas sociais.",
            'Alto': "<strong>Estrat√©gia:</strong> Automa√ß√£o completa, materiais nobres (pedras naturais) e design assinado. Exclusividade √© a chave."
        };

        const DB_LABELS = { 'TEC': 'Tecnologia/Automa√ß√£o', 'AZUL': 'Tons Frios (Azul)', 'MADEIRA': 'Madeira Natural', 'METAL': 'Metal/Industrial', 'BAGUNCA': 'Toler√¢ncia a Bagun√ßa', 'FLUXO': 'Fluxo/Circula√ß√£o', 'ACONCHEGO': 'Aconchego/Ninho', 'LAR': 'Valoriza√ß√£o do Lar', 'INFANCIA': 'Mem√≥ria de Inf√¢ncia', 'VIAGEM': 'Mem√≥ria de Viagem', 'DIAADIA': 'Rotina Di√°ria', 'OBJETO': 'Objeto Afetivo', 'RELATO': 'Relato Pessoal', 'INSPIRACAO': 'Inspira√ß√£o', 'RUIDO': 'Sensibilidade a Ru√≠do', 'POS': 'P√≥s-Ocupa√ß√£o' };

        let dadosAPI = [];

        async function init() {
            try {
                const req = await fetch('https://api-neurobriefing.onrender.com/api/relatorios');
                dadosAPI = await req.json();
                dadosAPI.sort((a, b) => new Date(b.data) - new Date(a.data));
                renderTable();
            } catch(e) { console.error(e); }
        }

        function checkMod(r, k){ return r && Object.keys(r).some(x=>x.startsWith(k)); }
        function formatTime(s) { s = parseInt(s); if(isNaN(s)) return "00:00"; return `${Math.floor(s/60)}:${s%60 < 10 ? '0'+(s%60) : s%60}`; }

        function renderTable() {
            const t = document.getElementById('lista'); t.innerHTML = '';
            if(dadosAPI.length === 0) { t.innerHTML = '<tr><td colspan="5">Nenhum dossi√™ encontrado.</td></tr>'; return; }
            dadosAPI.forEach((d, i) => {
                const r = d.respostas || {};
                const hasHumana = checkMod(r, 'fogo') || checkMod(r, 'ar_');
                const hasVisual = checkMod(r, 'est_');
                const hasSensorial = checkMod(r, 'vis_') || checkMod(r, 'aud_');
                const hasMemorias = checkMod(r, 'mem_');
                const hasAtual = checkMod(r, 'atu_');
                t.innerHTML += `<tr><td>${new Date(d.data).toLocaleDateString()}</td><td><span class="cli-name">${d.cliente}</span></td><td>${d.contato?.arquiteto||'-'}</td><td><div class="mod-grid"><span class="mod-tag ${hasHumana?'done':''}">Humana</span><span class="mod-tag ${hasVisual?'done':''}">Visual</span><span class="mod-tag ${hasSensorial?'done':''}">Sensorial</span><span class="mod-tag ${hasMemorias?'done':''}">Mem√≥rias</span><span class="mod-tag ${hasAtual?'done':''}">Atual</span></div></td><td style="text-align:right"><button class="btn-pdf" onclick="makePDF(${i}, this)">Gerar PDF</button></td></tr>`;
            });
        }

        async function makePDF(index, btn) {
            try {
                const d = dadosAPI[index];
                const original = btn.innerText; btn.innerText = "Gerando..."; btn.disabled = true;
                const r = d.respostas || {};

                // CAPA
                if(document.getElementById('cp-nome')) document.getElementById('cp-nome').innerText = d.cliente || '-';
                if(document.getElementById('cp-arq')) document.getElementById('cp-arq').innerText = d.contato?.arquiteto || '-';
                if(document.getElementById('cp-data')) document.getElementById('cp-data').innerText = d.data ? new Date(d.data).toLocaleDateString() : '-';

                // --- MOD 1 ---
                let p = { FOGO:0, AR:0, AGUA:0, TERRA:0 };
                Object.keys(r).forEach(k => {
                    let v = parseInt(r[k]) || 0;
                    if(k.startsWith('fogo')) p.FOGO += v; if(k.startsWith('ar_')) p.AR += v;
                    if(k.startsWith('agua')) p.AGUA += v; if(k.startsWith('terra')) p.TERRA += v;
                });
                const sorted = [{id:'FOGO',...DB.FOGO,v:p.FOGO},{id:'AR',...DB.AR,v:p.AR},{id:'AGUA',...DB.AGUA,v:p.AGUA},{id:'TERRA',...DB.TERRA,v:p.TERRA}].sort((a,b)=>b.v-a.v);
                const dom = sorted[0]; const sec = sorted[1]; const sombra = sorted[3];

                if(document.getElementById('t1-time')) document.getElementById('t1-time').innerText = formatTime(d.tempos?.[0] || 0);
                let chartHTML = '';
                sorted.forEach(i => {
                    let pct = Math.min((i.v / 25) * 100, 100);
                    chartHTML += `<div class="cc-box"><div class="cc-top"><span class="cc-lbl c-${i.class}">${i.id}</span><span class="cc-val">${i.v}</span></div><div class="cc-bar"><div class="cc-fill bg-${i.class}" style="width:${pct}%"></div></div></div>`;
                });
                if(document.getElementById('chart-container')) document.getElementById('chart-container').innerHTML = chartHTML;
                if(document.getElementById('wb-head')) document.getElementById('wb-head').style.backgroundColor = dom.cor;
                if(document.getElementById('txt-el')) document.getElementById('txt-el').innerText = dom.id;
                if(document.getElementById('txt-tit')) document.getElementById('txt-tit').innerText = dom.titulo;
                if(document.getElementById('m1-content')) document.getElementById('m1-content').innerHTML = `<div class="info-row"><span class="il">Energia</span><span class="iv">${dom.energia}</span></div><div class="info-row"><span class="il">Perfil</span><span class="iv">${dom.quem}</span></div><div class="info-row"><span class="il">Estilos</span><span class="iv">${dom.estilos.join(', ')}</span></div>`;
                
                if(document.getElementById('m1-neuro-individual')) document.getElementById('m1-neuro-individual').innerHTML = dom.neuro;
                if(document.getElementById('m1-comunicacao-individual')) document.getElementById('m1-comunicacao-individual').innerHTML = dom.comunicacao;

                const keyComb = `${dom.id}_${sec.id}`;
                const dataComb = CORRELACOES[keyComb] || { perfil:'Misto', projeto:'Equil√≠brio', atendimento:'Adapt√°vel' };
                if(document.getElementById('m1-perfil-texto')) document.getElementById('m1-perfil-texto').innerHTML = dataComb.perfil;
                if(document.getElementById('m1-projeto-texto')) document.getElementById('m1-projeto-texto').innerHTML = dataComb.projeto;
                const txtSombra = SOMBRAS[sombra.id] || "Buscar equil√≠brio.";
                if(document.getElementById('m1-sombra-texto')) document.getElementById('m1-sombra-texto').innerHTML = `Menos Acessado: <strong>${sombra.id}</strong><br>${txtSombra}`;
                if(document.getElementById('m1-comunicacao-texto')) document.getElementById('m1-comunicacao-texto').innerHTML = dataComb.atendimento;

                // --- MOD 2 ---
                if(document.getElementById('t2-time')) document.getElementById('t2-time').innerText = formatTime(d.tempos?.[1] || 0);
                let visualScores = [];
                Object.keys(r).forEach(k => { if(k.startsWith('est_')) visualScores.push({id:k, nome:DB_VISUAL[k]||k, val:parseInt(r[k])||0}); });
                visualScores.sort((a,b)=>b.val-a.val);
                if(visualScores.length > 0) {
                    const top = visualScores[0];
                    const det = DB_VISUAL_DETAILS[top.id] || DB_VISUAL_DETAILS['default'];
                    // Parte A
                    if(document.getElementById('vis-top1-nome')) document.getElementById('vis-top1-nome').innerText = top.nome;
                    if(document.getElementById('vis-top1-nota')) document.getElementById('vis-top1-nota').innerText = top.val;
                    let richHTML = `<div class="strategy-grid"><div class="st-card highlight"><div class="st-head">üóùÔ∏è CONCEITO</div><div class="st-text">${det.conceito}</div></div><div class="st-card"><div class="st-head">üß† NEURO DICA</div><div class="st-text">${det.neuro}</div></div></div>`;
                    richHTML += `<div class="strategy-grid"><div class="st-card"><div class="st-head">üß± MATERIAIS</div><div class="st-text">${det.materiais}</div></div><div class="st-card"><div class="st-head">üí° ILUMINA√á√ÉO</div><div class="st-text">${det.luz}</div></div><div class="st-card"><div class="st-head">ü™ë MOBILI√ÅRIO</div><div class="st-text">${det.mobiliario}</div></div></div>`;
                    richHTML += `<div style="margin-top:15px; font-size:9pt; font-weight:700; color:#999;">AFINIDADES SECUND√ÅRIAS:</div>`;
                    richHTML += visualScores.slice(1,5).map(i=>`<div class="item-list"><span class="il-lbl">${i.nome}</span><span class="il-val">${i.val}%</span></div>`).join('');
                    if(document.getElementById('m2-content')) document.getElementById('m2-content').innerHTML = richHTML;

                    // M√≥dulo 2B - Protocolo (V58)
                    const extended = DB_VISUAL_EXTENDED[top.id] || DB_VISUAL_EXTENDED['default'];
                    let dnaHTML = `<div class="dna-box">${extended.dna.cores.map(c=>`<div class="dna-color" style="background:${c}"></div>`).join('')}</div><div><strong>Formas:</strong> ${extended.dna.formas}</div><div><strong>Texturas:</strong> ${extended.dna.texturas}</div>`;
                    if(document.getElementById('m2-dna-content')) document.getElementById('m2-dna-content').innerHTML = dnaHTML;

                    let mandHTML = `<ul class="tech-list">${extended.mandatorios.map(m=>`<li class="tech-item">${m}</li>`).join('')}</ul>`;
                    let avoidHTML = `<ul class="tech-list">${extended.evitar.map(m=>`<li class="tech-item bad">${m}</li>`).join('')}</ul>`;
                    if(document.getElementById('m2-mandatory')) document.getElementById('m2-mandatory').innerHTML = mandHTML;
                    if(document.getElementById('m2-avoid')) document.getElementById('m2-avoid').innerHTML = avoidHTML;
                    if(document.getElementById('m2-lighting')) document.getElementById('m2-lighting').innerText = extended.luz;
                    if(document.getElementById('m2-conclusao-dinamica')) document.getElementById('m2-conclusao-dinamica').innerText = `Perfil ${top.nome}: Siga os mandat√≥rios para garantir a coer√™ncia estil√≠stica.`;
                }

                // --- MOD 3 (2 P√ÅGINAS C/ DETALHES) ---
                if(document.getElementById('t3-time')) document.getElementById('t3-time').innerText = formatTime(d.tempos?.[2] || 0);
                
                const sVals = {
                    vis: r['vis_complex'] !== undefined ? parseInt(r['vis_complex']) : 50,
                    aud: r['aud_eco'] !== undefined ? parseInt(r['aud_eco']) : 50,
                    olf: r['olf_sens'] !== undefined ? parseInt(r['olf_sens']) : 50,
                    tat: r['tat_tex_macia'] !== undefined ? parseInt(r['tat_tex_macia']) : 50,
                    prop: r['prop_pe_dir'] !== undefined ? parseInt(r['prop_pe_dir']) : 50,
                    gus: r['gus_social'] !== undefined ? parseInt(r['gus_social']) : 50,
                    emo: r['emo_nostalgia'] !== undefined ? parseInt(r['emo_nostalgia']) : 50,
                    cog: r['cog_prod'] !== undefined ? parseInt(r['cog_prod']) : 50
                };

                const genCardA = (k) => {
                    const info = DB_SENSORY_EXPERT[k];
                    const val = sVals[k];
                    const stratHTML = info.getStrat(val);
                    return `<div class="sense-card ${info.color}"><div class="sense-head"><span class="sense-title ${info.color}"><span class="sense-icon">${info.icon}</span> ${info.title}</span></div><div class="sense-bar-container"><div class="sense-bar-bg"><div class="sense-bar-fill ${info.border}" style="width:${val}%"></div></div><span class="sense-val ${info.color}">${val}%</span></div><div class="sense-strategy">${stratHTML}</div></div>`;
                };
                
                const genCardB = (k) => {
                    const info = DB_SENSORY_EXPERT[k];
                    const val = sVals[k];
                    const stratHTML = info.getStrat(val);
                    return `<div class="sense-card ${info.color}"><div class="sense-head"><span class="sense-title ${info.color}"><span class="sense-icon">${info.icon}</span> ${info.title}</span></div><div class="sense-bar-container"><div class="sense-bar-bg"><div class="sense-bar-fill ${info.border}" style="width:${val}%"></div></div><span class="sense-val ${info.color}">${val}%</span></div><div class="sense-strategy">${stratHTML}</div></div>`;
                };

                // GRID A (4)
                const keysA = ['vis','aud','olf','tat'];
                let htmlA = ''; keysA.forEach(k => htmlA += genCardA(k));
                if(document.getElementById('m3-grid-part-a')) document.getElementById('m3-grid-part-a').innerHTML = htmlA;

                // GRID B (4)
                const keysB = ['prop','gus','emo','cog'];
                let htmlB = ''; keysB.forEach(k => htmlB += genCardB(k));
                if(document.getElementById('m3-grid-part-b')) document.getElementById('m3-grid-part-b').innerHTML = htmlB;


                // --- MOD 4 (P√ÅGINA 7 e 8) ---
                if(document.getElementById('t4-time')) document.getElementById('t4-time').innerText = formatTime(d.tempos?.[3] || 0);
                
                let explHTML = '', implHTML = '', txtHTML = '';
                let highestMem = { key: 'default', val: 0 }; 

                // SEPARA√á√ÉO RIGOROSA
                Object.keys(r).forEach(k => {
                    if(k.startsWith('mem_epi') || k.startsWith('mem_sem')) {
                        let rawLabel = k.split('_')[2].toUpperCase();
                        let label = DB_LABELS[rawLabel] || rawLabel; 
                        let val = r[k];
                        if(typeof val === 'number') {
                            if(val > highestMem.val) highestMem = { key: k, val: val };
                            let actionComment = DB_MEM_ACTIONS[rawLabel] ? (val > 50 ? DB_MEM_ACTIONS[rawLabel].high : DB_MEM_ACTIONS[rawLabel].low) : "";
                            explHTML += `<div class="mem-container mem-epi"><div class="mem-label-row"><span class="mem-title">${label}</span><span class="mem-val">${val}%</span></div><div class="mem-track"><div class="mem-fill" style="width:${val}%"></div></div><div class="mem-scale"><span>0</span><span>50</span><span>100</span></div><div class="mem-action-comment">${actionComment}</div></div>`;
                        } else if (typeof val === 'string' && val.length > 2) {
                             txtHTML += `<div class="mem-text-box"><span class="mem-text-label">${label}</span><div class="mem-text-val">"${val}"</div></div>`;
                        }
                    }
                    if(k.startsWith('mem_proc') || k.startsWith('mem_prim') || k.startsWith('mem_cond')) {
                        let rawLabel = k.split('_')[2].toUpperCase();
                        let label = DB_LABELS[rawLabel] || rawLabel; 
                        let val = r[k];
                        if(typeof val === 'number') {
                            let actionComment = DB_MEM_ACTIONS[rawLabel] ? (val > 50 ? DB_MEM_ACTIONS[rawLabel].high : DB_MEM_ACTIONS[rawLabel].low) : "";
                            implHTML += `<div class="mem-container mem-imp"><div class="mem-label-row"><span class="mem-title">${label}</span><span class="mem-val">${val}%</span></div><div class="mem-track"><div class="mem-fill" style="width:${val}%"></div></div><div class="mem-scale"><span>0</span><span>50</span><span>100</span></div><div class="mem-action-comment">${actionComment}</div></div>`;
                        } else if (typeof val === 'string' && val.length > 2) {
                            txtHTML += `<div class="mem-text-box"><span class="mem-text-label">${label}</span><div class="mem-text-val">"${val}"</div></div>`;
                        }
                    }
                });

                if(document.getElementById('m4-expl-graficos')) document.getElementById('m4-expl-graficos').innerHTML = explHTML;
                if(document.getElementById('m4-impl-graficos')) document.getElementById('m4-impl-graficos').innerHTML = implHTML;
                if(document.getElementById('m4-textos')) document.getElementById('m4-textos').innerHTML = txtHTML;
                
                let strategyText = DB_MEMORY_STRATEGIES['default'];
                for (const key in DB_MEMORY_STRATEGIES) {
                    if (highestMem.key.includes(key)) {
                        strategyText = DB_MEMORY_STRATEGIES[key];
                        break;
                    }
                }
                
                let vinculoText = "V√≠nculo Misto (Passado/Presente).";
                if(highestMem.key.includes('infancia')) vinculoText = "V√≠nculo Forte com o PASSADO (Nostalgia).";
                else if(highestMem.key.includes('viagem')) vinculoText = "V√≠nculo com a EXPERI√äNCIA (Explora√ß√£o).";
                else if(highestMem.key.includes('lar')) vinculoText = "V√≠nculo com o PRESENTE (Acolhimento).";
                
                if(document.getElementById('m4-vinculo')) document.getElementById('m4-vinculo').innerText = vinculoText;
                if(document.getElementById('m4-ancoragem')) document.getElementById('m4-ancoragem').innerHTML = strategyText;
                if(document.getElementById('m4-conclusao-dinamica')) document.getElementById('m4-conclusao-dinamica').innerHTML = strategyText;

                // --- MOD 5 (ENRIQUECIDO COM INSIGHTS) ---
                if(document.getElementById('t5-time')) document.getElementById('t5-time').innerText = formatTime(d.tempos?.[4] || 0);
                
                // Helper de Insights
                const getPhaseInsight = (arr) => {
                    if (!arr) return "";
                    let insight = "";
                    if (arr.toString().includes("Crian√ßas")) insight = DB_PHASE_INSIGHTS['Crian√ßas'];
                    else if (arr.toString().includes("Adolescentes")) insight = DB_PHASE_INSIGHTS['Adolescentes'];
                    else if (arr.toString().includes("Idosos")) insight = DB_PHASE_INSIGHTS['Idosos'];
                    else if (arr.toString().includes("Casal")) insight = DB_PHASE_INSIGHTS['Casal'];
                    else if (arr.toString().includes("Solteiro")) insight = DB_PHASE_INSIGHTS['Solteiro'];
                    return insight;
                };
                
                const getInvestInsight = (arr) => {
                    if (!arr) return "";
                    let insight = "";
                    if (arr.toString().includes("Econ√¥mico")) insight = DB_INVEST_INSIGHTS['Econ√¥mico'];
                    else if (arr.toString().includes("M√©dio")) insight = DB_INVEST_INSIGHTS['M√©dio'];
                    else if (arr.toString().includes("Alto")) insight = DB_INVEST_INSIGHTS['Alto'];
                    return insight;
                };

                const makeTags = (key, elId, insightId, type) => {
                    const el = document.getElementById(elId); if(el) el.innerHTML = '';
                    const val = r[key];
                    if(Array.isArray(val)) {
                        val.forEach(item => el.innerHTML += `<span class="ct-item">${item}</span>`);
                        if(insightId) {
                            let text = (type === 'phase') ? getPhaseInsight(val) : (type === 'invest') ? getInvestInsight(val) : "";
                            if(text) document.getElementById(insightId).innerHTML = text;
                        }
                    }
                    else if(val) {
                         el.innerHTML = `<span class="ct-item">${val}</span>`;
                         if(insightId) {
                             let text = (type === 'invest') ? getInvestInsight(val) : "";
                             if(text) document.getElementById(insightId).innerHTML = text;
                         }
                    }
                    else el.innerHTML = '-';
                };

                makeTags('atu_fase_vida', 'm5-fase', 'm5-fase-insight', 'phase'); 
                makeTags('atu_investimento', 'm5-invest', 'm5-invest-insight', 'invest');
                makeTags('atu_hobbies', 'm5-hobbies'); 
                makeTags('atu_personalidade', 'm5-pers');
                
                const tempo = r['atu_tempo'] || 0;
                if(document.getElementById('m5-tempo-bar')) document.getElementById('m5-tempo-bar').style.width = tempo + '%';
                if(document.getElementById('m5-tempo-val')) document.getElementById('m5-tempo-val').innerText = tempo + '% (0=Curto, 100=Longo)';
                if(document.getElementById('m5-obs')) document.getElementById('m5-obs').innerText = r['atu_obs_geral'] || '-';

                let investStrat = DB_LIFESTYLE['default'];
                if(tempo < 40) investStrat = DB_LIFESTYLE['curto_prazo'];
                else if(tempo > 70) investStrat = DB_LIFESTYLE['longo_prazo'];
                
                if(document.getElementById('m5-invest-matrix')) document.getElementById('m5-invest-matrix').innerHTML = investStrat;
                
                let hobbyAction = "Cada hobby listado requer um cen√°rio.";
                if (r['atu_hobbies'] && r['atu_hobbies'].toString().includes("Cozinhar")) hobbyAction = "Cozinhar: Requer tri√¢ngulo de trabalho eficiente e exaust√£o for√ßada.";
                if (r['atu_hobbies'] && r['atu_hobbies'].toString().includes("Filmes")) hobbyAction = "Filmes: Prever blackout total e sof√° retr√°til.";
                if(document.getElementById('m5-ritual-tips')) document.getElementById('m5-ritual-tips').innerText = hobbyAction;

                // DOWNLOAD
                const el = document.getElementById('pdf-root');
                el.style.display = 'block';
                window.scrollTo(0, 0); 
                setTimeout(async () => {
                    const opt = { margin: 0, filename: `Dossie_${d.cliente}_Completo.pdf`, image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2, scrollY: 0, useCORS: true }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } };
                    await html2pdf().set(opt).from(el).save();
                    el.style.display = 'none';
                    btn.innerText = original; btn.disabled = false;
                }, 1000);

            } catch (err) {
                console.error("ERRO AO GERAR PDF:", err);
                alert("Erro ao gerar PDF: " + err.message);
                btn.innerText = "Erro"; btn.disabled = false;
            }
        }

        init();
    </script>
</body>
</html>