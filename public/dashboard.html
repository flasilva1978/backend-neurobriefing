<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Neuro Be Briefing | Diagn√≥stico Integral</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* ==========================================================================
           1. ESTILOS GERAIS E RESET
           ========================================================================== */
        * {
            box-sizing: border-box;
            -webkit-print-color-adjust: exact;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        /* ==========================================================================
           2. ESTILOS DO PAINEL (TELA)
           ========================================================================== */
        .painel {
            max-width: 1200px;
            margin: 0 auto 30px auto;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .header-painel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .hp-title {
            font-size: 18pt;
            font-weight: 800;
            color: #2c3e50;
        }

        .btn-refresh {
            background: #2c3e50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 700;
            font-size: 9pt;
            transition: 0.2s;
        }

        .btn-refresh:hover {
            background: #34495e;
        }

        /* TABELA */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 15px 10px;
            background: #f8f9fa;
            color: #7f8c8d;
            font-weight: 700;
            font-size: 8pt;
            text-transform: uppercase;
            border-bottom: 2px solid #eee;
        }

        td {
            padding: 15px 10px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
            font-size: 9.5pt;
        }

        tr:hover {
            background-color: #fafafa;
        }

        .cli-name {
            font-size: 11pt;
            font-weight: 700;
            color: #2c3e50;
            display: block;
            margin-bottom: 4px;
        }

        .mod-grid {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .mod-tag {
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 7pt;
            font-weight: 700;
            text-transform: uppercase;
            background: #eee;
            color: #bbb;
            border: 1px solid #e0e0e0;
        }

        .mod-tag.done {
            background: #e8f5e9;
            color: #27ae60;
            border-color: #c8e6c9;
        }

        .btn-pdf {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 8pt;
            cursor: pointer;
        }

        .btn-pdf:hover {
            background: #c0392b;
        }

        /* ==========================================================================
           3. ESTILOS DO PDF (LAYOUT 11 P√ÅGINAS)
           ========================================================================== */
        #pdf-root {
            display: none;
        }

        .page {
            width: 210mm;
            height: 296mm;
            background: white;
            position: relative;
            overflow: hidden;
            margin: 0 auto;
            page-break-after: always;
            padding: 0;
        }

        .page:last-child {
            page-break-after: avoid;
        }

        /* CAPA */
        .capa-box {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 20mm solid #f4f6f8;
            text-align: center;
        }

        .c-logo {
            font-size: 38pt;
            font-weight: 900;
            color: #2c3e50;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .c-sub {
            font-size: 10pt;
            letter-spacing: 4px;
            text-transform: uppercase;
            color: #7f8c8d;
            margin-bottom: 80px;
        }

        .c-info {
            width: 80%;
            border-top: 2px solid #2c3e50;
            border-bottom: 2px solid #2c3e50;
            padding: 40px 0;
            margin-bottom: 50px;
        }

        .ci-lbl {
            font-size: 8pt;
            font-weight: 700;
            color: #aaa;
            text-transform: uppercase;
            margin-bottom: 5px;
            display: block;
        }

        .ci-val {
            font-size: 16pt;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 25px;
            display: block;
        }

        /* MOD CONTENT */
        .mod-content {
            padding: 15mm;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .m-head {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            border-bottom: 4px solid #2c3e50;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .mh-tit {
            font-size: 22pt;
            font-weight: 800;
            color: #2c3e50;
        }

        .mh-num {
            font-size: 30pt;
            font-weight: 900;
            color: #eee;
        }

        .win-box {
            border: 1px solid #ccc;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .wb-head {
            padding: 10px 15px;
            color: white;
            font-weight: 800;
            text-transform: uppercase;
        }

        .wb-body {
            padding: 20px;
            font-size: 9.5pt;
            line-height: 1.6;
        }

        .strategy-grid {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .st-card {
            flex: 1;
            background: #fdfdfd;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 15px;
        }

        .st-head {
            font-size: 9pt;
            font-weight: 800;
            color: #2c3e50;
            text-transform: uppercase;
            margin-bottom: 8px;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }

        .st-text {
            font-size: 8.5pt;
            color: #555;
            line-height: 1.5;
        }

        .charts {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            height: 40px;
        }

        .cc-box {
            flex: 1;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 5px 8px;
            background: #fafafa;
        }

        .cc-bar {
            width: 100%;
            height: 5px;
            background: #ddd;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }

        .cc-fill { height: 100%; }

        .box-conclusao {
            background: #fdfdfd;
            border-left: 4px solid #2c3e50;
            padding: 15px;
            font-size: 9pt;
            margin-top: auto;
        }

        .ft-note {
            text-align: center;
            font-size: 6pt;
            color: #bbb;
            padding-top: 10px;
        }

        /* SENSORIAL */
        .sensory-page-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 20px;
            flex: 1;
        }

        .sense-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            border-top: 5px solid #ccc;
        }

        .sense-txt {
            font-size: 8.5pt;
            line-height: 1.4;
        }

        /* MEM√ìRIAS */
        .mem-container { width: 48%; margin-bottom: 15px; }

        .check-tags { display: flex; flex-wrap: wrap; gap: 5px; }
        .ct-item { background: #f0f2f5; padding: 6px 12px; border-radius: 4px; font-size: 9pt; font-weight: 600; border: 1px solid #ddd; }
        .insight-box { background: #eafaf1; border: 1px solid #d5f5e3; padding: 10px; margin-top: 10px; font-size: 8.5pt; color: #27ae60; font-style: italic; }

        .c-fogo { color: #e74c3c; } .bg-fogo { background: #e74c3c; }
        .c-ar { color: #3498db; } .bg-ar { background: #3498db; }
        .c-agua { color: #2980b9; } .bg-agua { background: #2980b9; }
        .c-terra { color: #27ae60; } .bg-terra { background: #27ae60; }
    </style>
</head>
<body>

    <div class="painel">
        <div class="header-painel">
            <div class="hp-title">Dashboard Neuro Be Briefing</div>
            <button class="btn-refresh" onclick="location.reload()">üîÑ Atualizar Dados</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th style="width: 100px;">Data</th>
                    <th style="width: 30%;">Cliente</th>
                    <th style="width: 20%;">Respons√°vel</th>
                    <th style="text-align:right;">A√ß√£o</th>
                </tr>
            </thead>
            <tbody id="lista"><tr><td colspan="4">Carregando dados...</td></tr></tbody>
        </table>
    </div>

    <div id="pdf-root">
        
        <div class="page">
            <div class="capa-box">
                <div class="c-logo">NEURO BE BRIEFING</div>
                <div class="c-sub">Diagn√≥stico Integral & Estrat√©gia de Projeto</div>
                <div class="c-info">
                    <span class="ci-lbl">Cliente</span><span class="ci-val" id="cp-nome">-</span>
                    <span class="ci-lbl">Designer / Arquiteto Respons√°vel</span><span class="ci-val" id="cp-arq">-</span>
                    <span class="ci-lbl">Data do Diagn√≥stico</span><span class="ci-val" id="cp-data">-</span>
                </div>
                <div class="ft-note">Neuro Be Briefing Intelligence - P√°gina 1 de 11</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div><div class="mh-tit">IDENTIDADE DO SER</div><div class="mh-sub">Arqu√©tipo & Temperamento (Biotipo & Neuroarquitetura)</div></div>
                    <div class="mh-num">01</div>
                </div>
                <div class="charts" id="chart-container"></div>
                <div class="win-box">
                    <div class="wb-head" id="wb-head"><div class="wb-tit" id="txt-el">-</div><div class="wb-sty" id="txt-tit">-</div></div>
                    <div class="wb-body" id="m1-content"></div>
                </div>
                <div class="strategy-grid">
                    <div class="st-card"><div class="st-head">üß† NEUROARQUITETURA (BIOTIPO)</div><div class="st-text" id="m1-neuro-individual"></div></div>
                    <div class="st-card"><div class="st-head">‚ö° ENERGIA & ESTILO BASE</div><div class="st-text" id="m1-energia-base"></div></div>
                </div>
                <div class="ft-note">Neuro Be Briefing Intelligence - P√°gina 2 de 11</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div><div class="mh-tit">IDENTIDADE DO SER</div><div class="mh-sub">Estrat√©gia de Atendimento & Gest√£o do Cliente</div></div>
                    <div class="mh-num">01</div>
                </div>
                <div class="win-box">
                    <div class="wb-head" style="background:#2c3e50;"><div class="wb-tit">PROTOCOLO DE ATENDIMENTO</div></div>
                    <div class="wb-body" id="m1-atendimento-deep"></div>
                </div>
                <div class="strategy-grid">
                    <div class="st-card" style="border-left:5px solid #e74c3c;">
                        <div class="st-head">‚ö†Ô∏è PONTO DE ATEN√á√ÉO (SOMBRA)</div>
                        <div class="st-text" id="m1-sombra-texto"></div>
                    </div>
                    <div class="st-card" style="border-left:5px solid #27ae60;">
                        <div class="st-head">‚úÖ DIRETRIZES DE PROJETO</div>
                        <div class="st-text" id="m1-projeto-texto"></div>
                    </div>
                </div>
                <div class="box-conclusao" id="m1-fechamento"></div>
                <div class="ft-note">Neuro Be Briefing Intelligence - P√°gina 3 de 11</div>
            </div>
        </div>

        </div>

    <script>
        // BANCO DE DADOS EXPANDIDO (M√ìDULO 1)
        const DB_HUMANA_NEW = {
            TERRA: { 
                cor:'#27ae60', class:'terra', titulo:'Analista (Melanc√≥lico)', energia:'Estrutura, Rigor e Profundidade.',
                neuro: 'O c√©rebro melanc√≥lico busca previsibilidade. Ambientes com <strong>simetria axial</strong> e arm√°rios fechados reduzem o ru√≠do cognitivo. Evite layouts abertos demais que gerem sensa√ß√£o de vulnerabilidade.',
                atendimento: 'Apresente dados t√©cnicos, amostras f√≠sicas e cronogramas r√≠gidos. N√£o mude planos de √∫ltima hora. Ganhe a confian√ßa atrav√©s da precis√£o e do respeito ao sil√™ncio.',
                projeto: 'Foco em Minimalismo Purista e Cl√°ssico. Materiais naturais est√°veis como pedra e madeira maci√ßa.',
                sombra: 'Tend√™ncia ao perfeccionismo paralisante. Irrita√ß√£o com desorganiza√ß√£o visual ou atrasos inexplicados.'
            },
            FOGO: { 
                cor:'#e74c3c', class:'fogo', titulo:'Executor (Col√©rico)', energia:'A√ß√£o, Domin√¢ncia e Intensidade.',
                neuro: 'Busca dopamin√©rgica por recompensa e controle. O espa√ßo deve ter <strong>fluxos desimpedidos</strong> e materiais que transmitam solidez. √Åreas de comando (vis√£o da entrada) s√£o essenciais.',
                atendimento: 'Seja direto, objetivo e valorize o tempo dele. Apresente solu√ß√µes prontas ("Isso resolve seu problema"). N√£o d√™ op√ß√µes demais; d√™ a melhor.',
                projeto: 'Industrial Moderno ou Contempor√¢neo Brutalista. Automa√ß√£o robusta e tecnologia de ponta.',
                sombra: 'Impaci√™ncia extrema. Pode se tornar agressivo se sentir que o projeto est√° "lento" ou burocr√°tico.'
            },
            AR: { 
                cor:'#3498db', class:'ar', titulo:'Comunicador (Sangu√≠neo)', energia:'Conex√£o, Variedade e Criatividade.',
                neuro: 'Necessidade de est√≠mulos variados para manter o interesse. <strong>Ambientes multiuso</strong> e layouts que favore√ßam a conversa. Cores quentes em pontos focais ativam o sistema l√≠mbico.',
                atendimento: 'Use apresenta√ß√µes visuais impactantes (VR, 3D). Seja entusiasta e valide as ideias criativas dele. Mantenha o clima leve e social.',
                projeto: 'Ecl√©tico, Boho Chic ou Maximalismo Curado. Espa√ßos "instagram√°veis" e de conv√≠vio social.',
                sombra: 'Falta de foco e t√©dio r√°pido. Pode abandonar decis√µes t√©cnicas se o processo for ma√ßante.'
            },
            AGUA: { 
                cor:'#2980b9', class:'agua', titulo:'Planejador (Fleum√°tico)', energia:'Harmonia, Acolhimento e Estabilidade.',
                neuro: 'Sistema l√≠mbico sens√≠vel ao estresse. Priorizar <strong>conforto ac√∫stico e texturas h√°picas</strong>. Ilumina√ß√£o circadiana (2700K) para relaxamento parassimp√°tico.',
                atendimento: 'Seja paciente e gentil. Ele precisa de tempo para decidir e geralmente consulta a fam√≠lia. Transmita paz e seguran√ßa no processo.',
                projeto: 'Japandi, Org√¢nico ou Wabi-Sabi. Cantos de ref√∫gio ("tocas") e biofilia abundante.',
                sombra: 'Resist√™ncia passiva a mudan√ßas bruscas. Dificuldade em dizer "n√£o" para algo que n√£o gostou.'
            }
        };

        // BANCO DE DADOS DE HOBBIES & PERSONALIDADE (M√ìDULO 5)
        const DB_HOBBIES_TECH = {
            'Cozinhar': '‚úÖ DO: Ilha gourmet, ilumina√ß√£o IRC>90. ‚ùå DONT: Cozinha isolada da √°rea social.',
            'M√∫sica': '‚úÖ DO: Zoneamento ac√∫stico e luz c√™nica. ‚ùå DONT: Espa√ßos com muito eco.',
            'Filmes': '‚úÖ DO: Blackout total e sof√° retr√°til profundo. ‚ùå DONT: Telas de frente para janelas.',
            'Games': '‚úÖ DO: Gest√£o de cabos e ilumina√ß√£o RGB indireta. ‚ùå DONT: Frieza t√©rmica.'
        };

        let relatorios = [];
        async function init() {
            try {
                const req = await fetch('https://api-neurobriefing.onrender.com/api/relatorios');
                relatorios = await req.json();
                relatorios.sort((a, b) => new Date(b.data) - new Date(a.data));
                renderTable();
            } catch(e) { console.error(e); }
        }

        function renderTable() {
            const t = document.getElementById('lista'); t.innerHTML = '';
            relatorios.forEach((d, i) => {
                t.innerHTML += `<tr><td>${new Date(d.data).toLocaleDateString()}</td><td><span class="cli-name">${d.cliente}</span></td><td>${d.contato?.arquiteto||'-'}</td><td style="text-align:right"><button class="btn-pdf" onclick="makePDF(${i}, this)">Gerar PDF (11 Pags)</button></td></tr>`;
            });
        }

        async function makePDF(index, btn) {
            const d = relatorios[index];
            const r = d.respostas || {};
            const original = btn.innerText; btn.innerText = "Gerando..."; btn.disabled = true;

            // PREENCHIMENTO CAPA
            document.getElementById('cp-nome').innerText = d.cliente;
            document.getElementById('cp-arq').innerText = d.contato?.arquiteto || '-';
            document.getElementById('cp-data').innerText = new Date(d.data).toLocaleDateString();

            // C√ÅLCULO M√ìDULO 1
            let p = { FOGO:0, AR:0, AGUA:0, TERRA:0 };
            Object.keys(r).forEach(k => {
                let v = parseInt(r[k]) || 0;
                if(k.startsWith('fogo')) p.FOGO += v; if(k.startsWith('ar_')) p.AR += v;
                if(k.startsWith('agua')) p.AGUA += v; if(k.startsWith('terra')) p.TERRA += v;
            });
            const sorted = Object.entries(p).sort((a,b)=>b[1]-a[1]);
            const domKey = sorted[0][0];
            const dom = DB_HUMANA_NEW[domKey];

            // Render P√°g 2 (Biol√≥gica)
            document.getElementById('wb-head').style.backgroundColor = dom.cor;
            document.getElementById('txt-el').innerText = domKey;
            document.getElementById('txt-tit').innerText = dom.titulo;
            document.getElementById('m1-content').innerText = dom.energia;
            document.getElementById('m1-neuro-individual').innerHTML = dom.neuro;
            document.getElementById('m1-energia-base').innerText = dom.projeto;

            // Render P√°g 3 (Atendimento)
            document.getElementById('m1-atendimento-deep').innerHTML = dom.atendimento;
            document.getElementById('m1-sombra-texto').innerHTML = dom.sombra;
            document.getElementById('m1-projeto-texto').innerHTML = dom.projeto;
            document.getElementById('m1-fechamento').innerHTML = `<span class="bc-tit">CONCLUS√ÉO DO M√ìDULO 1:</span> O DNA comportamental aponta para um projeto que prioriza a ${domKey.toLowerCase()}.`;

            // ... (O restante da l√≥gica de 1300+ linhas para Mod 2, 3, 4 e 5 deve ser mantida aqui)

            // GERA√á√ÉO PDF
            const el = document.getElementById('pdf-root');
            el.style.display = 'block';
            const opt = { margin: 0, filename: `Dossie_${d.cliente}.pdf`, image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } };
            await html2pdf().set(opt).from(el).save();
            el.style.display = 'none';
            btn.innerText = original; btn.disabled = false;
        }

        init();
    </script>
</body>
</html>