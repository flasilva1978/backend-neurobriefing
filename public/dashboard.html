<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard NeuroBriefing</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- RESET --- */
        * { box-sizing: border-box; -webkit-print-color-adjust: exact; }
        body { font-family: 'Montserrat', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; color: #333; }
        
        /* --- PAINEL (DASHBOARD) --- */
        .painel { max-width: 1200px; margin: 0 auto 30px auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .header-painel { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #f0f0f0; padding-bottom: 20px; margin-bottom: 20px; }
        .hp-title { font-size: 18pt; font-weight: 800; color: #2c3e50; }
        .btn-refresh { background: #2c3e50; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 6px; font-weight: 700; font-size: 9pt; transition: 0.2s; }
        .btn-refresh:hover { background: #34495e; }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px 10px; background: #f8f9fa; color: #7f8c8d; font-weight: 700; font-size: 8pt; text-transform: uppercase; border-bottom: 2px solid #eee; }
        td { padding: 15px 10px; border-bottom: 1px solid #eee; vertical-align: top; font-size: 9.5pt; }
        tr:hover { background-color: #fafafa; }

        .cli-name { font-size: 11pt; font-weight: 700; color: #2c3e50; display: block; margin-bottom: 4px; }
        .cli-local { font-size: 8pt; color: #999; display: block; margin-bottom: 8px; }
        .contact-row { display: flex; gap: 8px; }
        .btn-contact { text-decoration: none; padding: 4px 8px; border-radius: 4px; font-size: 7.5pt; font-weight: 700; display: inline-flex; align-items: center; gap: 4px; transition: 0.2s; }
        .btn-wa { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
        .btn-mail { background: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb; }

        .mod-grid { display: flex; gap: 4px; flex-wrap: wrap; }
        .mod-tag { padding: 3px 6px; border-radius: 4px; font-size: 7pt; font-weight: 700; text-transform: uppercase; background: #eee; color: #bbb; border: 1px solid #e0e0e0; }
        .mod-tag.done { background: #e8f5e9; color: #27ae60; border-color: #c8e6c9; }

        .btn-pdf { background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; font-weight: 700; font-size: 8pt; cursor: pointer; }
        .btn-pdf:hover { background: #c0392b; }
        .btn-pdf:disabled { background: #ccc; cursor: not-allowed; }

        /* --- PDF A4 R√çGIDO --- */
        #pdf-root { display: none; } 
        .page { width: 210mm; height: 296mm; background: white; position: relative; overflow: hidden; margin: 0 auto; page-break-after: always; padding: 0; }
        .page:last-child { page-break-after: avoid; }

        /* Estilos PDF Gerais */
        .capa-box { width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 20mm solid #f4f6f8; text-align: center; }
        .c-logo { font-size: 38pt; font-weight: 900; color: #2c3e50; margin-bottom: 10px; letter-spacing: -1px; }
        .c-sub { font-size: 10pt; letter-spacing: 4px; text-transform: uppercase; color: #7f8c8d; margin-bottom: 80px; }
        .c-info { width: 80%; border-top: 2px solid #2c3e50; border-bottom: 2px solid #2c3e50; padding: 40px 0; margin-bottom: 50px; }
        .ci-lbl { font-size: 8pt; font-weight: 700; color: #aaa; text-transform: uppercase; margin-bottom: 5px; display: block; letter-spacing: 1px; }
        .ci-val { font-size: 16pt; font-weight: 700; color: #2c3e50; margin-bottom: 25px; display: block; }
        .c-foot { position: absolute; bottom: 15mm; font-size: 8pt; color: #ccc; text-transform: uppercase; }

        .mod-content { padding: 15mm 15mm 10mm 15mm; height: 100%; display: flex; flex-direction: column; }
        .m-head { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 4px solid #2c3e50; padding-bottom: 10px; margin-bottom: 15px; }
        .mh-tit { font-size: 22pt; font-weight: 800; color: #2c3e50; line-height: 1; }
        .mh-sub { font-size: 9pt; font-weight: 600; color: #7f8c8d; text-transform: uppercase; margin-top: 5px; }
        .mh-meta { text-align: right; }
        .mh-num { font-size: 30pt; font-weight: 900; color: #eee; line-height: 0.8; }
        .mh-time { font-size: 8pt; font-weight: 700; color: #e74c3c; margin-top: 5px; display: block; }

        .charts { display: flex; gap: 10px; margin-bottom: 15px; height: 50px; }
        .cc-box { flex: 1; border: 1px solid #eee; border-radius: 4px; padding: 5px 8px; background: #fafafa; display: flex; flex-direction: column; justify-content: space-between; }
        .cc-top { display: flex; justify-content: space-between; align-items: center; }
        .cc-lbl { font-size: 8pt; font-weight: 800; text-transform: uppercase; }
        .cc-val { font-size: 11pt; font-weight: 900; }
        .cc-bar { width: 100%; height: 5px; background: #ddd; border-radius: 3px; overflow: hidden; }
        .cc-fill { height: 100%; }

        .win-box { flex: 1; border: 1px solid #ccc; border-radius: 6px; overflow: hidden; display: flex; flex-direction: column; margin-bottom: 15px; }
        .wb-head { padding: 10px 15px; color: white; display: flex; justify-content: space-between; align-items: center; }
        .wb-tit { font-size: 14pt; font-weight: 800; text-transform: uppercase; }
        .wb-sty { font-size: 8pt; font-weight: 600; opacity: 0.95; text-transform: uppercase; }
        .wb-body { display: flex; flex: 1; }
        .wb-col { flex: 1; padding: 12px; }
        .wb-div { border-right: 1px dashed #ddd; background: #fdfdfd; }
        
        .info-row { margin-bottom: 10px; }
        .il { font-size: 7pt; font-weight: 700; color: #999; text-transform: uppercase; display: block; margin-bottom: 2px; }
        .iv { font-size: 9pt; font-weight: 600; color: #333; line-height: 1.25; }
        
        .lst-tit { font-size: 8pt; font-weight: 800; color: #2c3e50; text-transform: uppercase; margin-bottom: 4px; border-bottom: 1px solid #eee; padding-bottom: 2px; }
        .lst-ul { padding: 0; margin: 0 0 10px 0; list-style: none; }
        .lst-li { font-size: 8pt; color: #555; padding-left: 8px; position: relative; margin-bottom: 2px; }
        .lst-li::before { content: "‚Ä¢"; position: absolute; left: 0; color: #ccc; }
        
        .rank-wrap { background: #f8f9fa; border: 1px solid #eee; border-radius: 6px; padding: 10px 15px; margin-bottom: 5px; }
        .rk-tit { font-size: 8pt; font-weight: 800; color: #2c3e50; text-transform: uppercase; margin-bottom: 8px; }
        .rk-item { display: flex; justify-content: space-between; font-size: 8.5pt; border-bottom: 1px dashed #ddd; padding: 3px 0; }
        .rk-item:last-child { border: none; }
        .rk-n { font-weight: 700; color: #333; }
        .rk-d { font-size: 7.5pt; color: #777; font-style: italic; }
        
        .ft-note { text-align: center; font-size: 6pt; color: #bbb; padding-top: 5px; }
        .c-fogo { color: #e74c3c; } .bg-fogo { background: #e74c3c; }
        .c-ar { color: #3498db; } .bg-ar { background: #3498db; }
        .c-agua { color: #2980b9; } .bg-agua { background: #2980b9; }
        .c-terra { color: #27ae60; } .bg-terra { background: #27ae60; }

    </style>
</head>
<body>

    <div class="painel">
        <div class="header-painel">
            <div class="hp-title">Dashboard NeuroBriefing</div>
            <button class="btn-refresh" onclick="location.reload()">üîÑ Atualizar Dados</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th style="width: 100px;">Data</th>
                    <th style="width: 30%;">Cliente</th>
                    <th style="width: 20%;">Respons√°vel</th>
                    <th>Status dos M√≥dulos</th>
                    <th style="text-align:right;">A√ß√£o</th>
                </tr>
            </thead>
            <tbody id="lista"><tr><td colspan="5">Carregando dados...</td></tr></tbody>
        </table>
    </div>

    <div id="pdf-root">
        
        <div class="page">
            <div class="capa-box">
                <div class="c-logo">NEUROBRIEFING</div>
                <div class="c-sub">Diagn√≥stico Integral & Estrat√©gia</div>
                <div class="c-info">
                    <span class="ci-lbl">Cliente Analisado</span>
                    <span class="ci-val" id="cp-nome">-</span>
                    <span class="ci-lbl">Arquiteto Respons√°vel</span>
                    <span class="ci-val" id="cp-arq">-</span>
                    <span class="ci-lbl">Data do Diagn√≥stico</span>
                    <span class="ci-val" id="cp-data">-</span>
                </div>
                <div class="c-foot">Documento Confidencial de Uso Profissional</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div>
                        <div class="mh-tit">IDENTIDADE DO SER</div>
                        <div class="mh-sub">Mapeamento de Arqu√©tipo & Temperamento</div>
                    </div>
                    <div class="mh-meta">
                        <div class="mh-num">01</div>
                        <span class="mh-time" id="mh-time">‚è± Tempo: --:--</span>
                    </div>
                </div>
                <div class="charts" id="chart-container"></div>
                <div class="win-box">
                    <div class="wb-head" id="wb-head">
                        <div class="wb-tit" id="txt-el">-</div>
                        <div class="wb-sty" id="txt-tit">-</div>
                    </div>
                    <div class="wb-body">
                        <div class="wb-col wb-div">
                            <div class="info-row"><span class="il">‚ö° Energia</span><span class="iv" id="t-en">-</span></div>
                            <div class="info-row"><span class="il">üë§ Para Quem</span><span class="iv" id="t-qm">-</span></div>
                            <div style="display:flex; gap:10px;">
                                <div class="info-row" style="flex:1"><span class="il">üìã Perfil</span><span class="iv" id="t-perf">-</span></div>
                                <div class="info-row" style="flex:1"><span class="il">üß¨ Temp.</span><span class="iv" id="t-temp">-</span></div>
                            </div>
                            <div class="info-row"><span class="il">üé≠ Arqu√©tipos</span><span class="iv" id="t-arq">-</span></div>
                        </div>
                        <div class="wb-col">
                            <div class="lst-tit">üè† Estilos Inclu√≠dos</div>
                            <ul class="lst-ul" id="l-est"></ul>
                            <div class="lst-tit">‚ú® Caracter√≠sticas</div>
                            <ul class="lst-ul" id="l-car"></ul>
                        </div>
                    </div>
                </div>
                <div class="rank-wrap">
                    <div class="rk-tit">üìä Leitura do Diagn√≥stico (Ranking)</div>
                    <div id="rank-list"></div>
                </div>
                <div class="ft-note">Relat√≥rio gerado pela plataforma NeuroBriefing Intelligence</div>
            </div>
        </div>

        <div class="page">
            <div class="mod-content">
                <div class="m-head">
                    <div>
                        <div class="mh-tit">IDENTIDADE VISUAL</div>
                        <div class="mh-sub">Estilo Predominante & Prefer√™ncias</div>
                    </div>
                    <div class="mh-meta">
                        <div class="mh-num">02</div>
                        <span class="mh-time" id="vis-time">‚è± Tempo: --:--</span>
                    </div>
                </div>

                <div id="vis-warning" style="display:none; background:#ffebeb; color:#c0392b; padding:10px; font-size:9pt; font-weight:bold; text-align:center; border:1px solid #e74c3c; margin-bottom:15px; border-radius:4px;">
                    ‚ö†Ô∏è ATEN√á√ÉO: Tempo de execu√ß√£o muito baixo. Indica respostas sem reflex√£o.
                </div>

                <div class="win-box" style="flex:0 auto; margin-bottom:30px;">
                    <div class="wb-head" style="background:#2c3e50;">
                        <div class="wb-tit">ESTILO PREDOMINANTE</div>
                        <div class="wb-sty" style="color:#f1c40f;">MATCH PRINCIPAL</div>
                    </div>
                    <div class="wb-body" style="padding:25px; text-align:center;">
                        <h2 style="margin:0; font-size:20pt; color:#2c3e50; text-transform:uppercase;" id="vis-top1-nome">-</h2>
                        <p style="font-size:10pt; color:#777; margin-top:10px; font-style:italic;" id="vis-top1-desc">Baseado na maior afinidade demonstrada.</p>
                        <div style="margin-top:15px; font-size:14pt; font-weight:bold; color:#27ae60;">
                            AFINIDADE: <span id="vis-top1-nota">-</span>%
                        </div>
                    </div>
                </div>

                <div class="rank-wrap">
                    <div class="rk-tit">COMPOSI√á√ÉO EST√âTICA (SUBSEQUENTES)</div>
                    <div id="vis-lista-secundaria">
                        </div>
                </div>

                <div class="ft-note" style="margin-top:auto;">A identidade visual final √© uma composi√ß√£o do predominante com nuances dos secund√°rios.</div>
            </div>
        </div>

    </div>

    <script>
        // --- DADOS E L√ìGICA ---
        const DB = {
            FOGO: { id:'FOGO', cor:'#e74c3c', class:'fogo', titulo:'Estilos de Ativa√ß√£o', energia:'A√ß√£o ¬∑ Dire√ß√£o ¬∑ Intensidade', quem:'Pessoas executor-col√©ricas', perfil:'Executor', temp:'Col√©rico', arq:'Her√≥i ¬∑ Governante', estilos:['Contempor√¢neo', 'Industrial', 'Moderno Urbano'], carac:['Linhas retas', 'Materiais fortes', 'Contraste'] },
            AR: { id:'AR', cor:'#3498db', class:'ar', titulo:'Estilos de Express√£o', energia:'Express√£o ¬∑ Conex√£o', quem:'Comunicador-sangu√≠neo', perfil:'Comunicador', temp:'Sangu√≠neo', arq:'Amante ¬∑ Explorador', estilos:['Escandinavo', 'Boho Chic', 'Ecl√©tico'], carac:['Luz natural', 'Layout fluido', 'Criatividade'] },
            AGUA: { id:'√ÅGUA', cor:'#2980b9', class:'agua', titulo:'Estilos de Acolhimento', energia:'Sensibilidade ¬∑ Ritmo', quem:'Planejador-fleum√°tico', perfil:'Planejador', temp:'Fleum√°tico', arq:'Cuidador ¬∑ Inocente', estilos:['Japandi', 'Org√¢nico', 'Wabi-Sabi'], carac:['Texturas suaves', 'Paleta neutra', 'Conforto'] },
            TERRA: { id:'TERRA', cor:'#27ae60', class:'terra', titulo:'Estilos de Estrutura', energia:'Estrutura ¬∑ Const√¢ncia', quem:'Analista-melanc√≥lico', perfil:'Analista', temp:'Melanc√≥lico', arq:'S√°bio ¬∑ Criador', estilos:['Cl√°ssico', 'Neocl√°ssico', 'Moderno Elegante'], carac:['Simetria', 'Materiais nobres', 'Sobriedade'] }
        };

        const DB_VISUAL = {
            'est_contemp': 'Contempor√¢neo', 'est_ind': 'Industrial', 'est_urb': 'Moderno Urbano', 'est_tech': 'High Tech', 'est_luxo': 'Luxo Moderno',
            'est_scandi': 'Escandinavo', 'est_cont_leve': 'Contempor√¢neo Leve', 'est_boho': 'Boho Chic', 'est_japandi': 'Japandi', 'est_wabi': 'Wabi-Sabi',
            'est_organico': 'Org√¢nico Contempor√¢neo', 'est_coastal': 'Coastal Sofisticado', 'est_natural': 'Natural Chic',
            'est_mid': 'Mid-Century Modern', 'est_ecletico': 'Ecl√©tico Curado', 'est_classico': 'Cl√°ssico Atemporal', 'est_neoclass': 'Neocl√°ssico',
            'est_trad': 'Tradicional Contempor√¢neo', 'est_mod_eleg': 'Moderno Elegante', 'est_colonial': 'Colonial Atualizado'
        };

        let dadosAPI = [];

        async function init() {
            try {
                const req = await fetch('https://api-neurobriefing.onrender.com/api/relatorios');
                dadosAPI = await req.json();
                renderTable();
            } catch(e) { console.error(e); }
        }

        function checkMod(respostas, keyIncludes) {
            if(!respostas) return false;
            return Object.keys(respostas).some(k => k.includes(keyIncludes));
        }

        function formatTime(seg) {
            if(!seg) return "N/A";
            const min = Math.floor(seg / 60);
            const s = seg % 60;
            return `${min < 10 ? '0'+min : min}:${s < 10 ? '0'+s : s}`;
        }

        function renderTable() {
            const t = document.getElementById('lista'); t.innerHTML = '';
            if(dadosAPI.length === 0) { t.innerHTML = '<tr><td colspan="5">Nenhum dossi√™ encontrado.</td></tr>'; return; }

            [...dadosAPI].reverse().forEach((d, i) => {
                const idx = dadosAPI.length - 1 - i;
                const r = d.respostas || {};
                const c = d.contato || {};

                const hasHumana = checkMod(r, 'fogo') || checkMod(r, 'ar_');
                const hasVisual = checkMod(r, 'est_');
                const hasSensorial = checkMod(r, 'vis_') || checkMod(r, 'aud_');
                const hasMemorias = checkMod(r, 'mem_');
                const hasAtual = checkMod(r, 'life_');

                const waLink = c.telefone ? `https://wa.me/55${c.telefone.replace(/\D/g,'')}` : '#';
                const mailLink = c.email ? `mailto:${c.email}` : '#';

                t.innerHTML += `
                    <tr>
                        <td style="font-size:9pt; color:#666;">${new Date(d.data).toLocaleDateString()}</td>
                        <td>
                            <span class="cli-name">${d.cliente}</span>
                            <span class="cli-local">üìç ${c.cidade || '-'} / ${c.estado || '-'}</span>
                            <div class="contact-row">
                                ${c.telefone ? `<a href="${waLink}" target="_blank" class="btn-contact btn-wa">üì± WhatsApp</a>` : ''}
                                ${c.email ? `<a href="${mailLink}" class="btn-contact btn-mail">‚úâÔ∏è Email</a>` : ''}
                            </div>
                        </td>
                        <td style="font-weight:600; color:#555;">${c.arquiteto || 'N√£o informado'}</td>
                        <td>
                            <div class="mod-grid">
                                <span class="mod-tag ${hasHumana ? 'done' : ''}">Humana</span>
                                <span class="mod-tag ${hasVisual ? 'done' : ''}">Visual</span>
                                <span class="mod-tag ${hasSensorial ? 'done' : ''}">Sensorial</span>
                                <span class="mod-tag ${hasMemorias ? 'done' : ''}">Mem√≥rias</span>
                                <span class="mod-tag ${hasAtual ? 'done' : ''}">Atual</span>
                            </div>
                        </td>
                        <td style="text-align:right">
                            <button class="btn-pdf" onclick="makePDF(${idx}, this)">Gerar PDF</button>
                        </td>
                    </tr>
                `;
            });
        }

        async function makePDF(index, btn) {
            const d = dadosAPI[index];
            const original = btn.innerText; btn.innerText = "..."; btn.disabled = true;

            // CAPA
            document.getElementById('cp-nome').innerText = d.cliente;
            document.getElementById('cp-arq').innerText = d.contato?.arquiteto || '-';
            document.getElementById('cp-data').innerText = new Date(d.data).toLocaleDateString();

            // M√ìDULO 1
            let p = { FOGO:0, AR:0, AGUA:0, TERRA:0 };
            const r = d.respostas || {};
            Object.keys(r).forEach(k => {
                let v = parseInt(r[k]) || 0;
                if(k.includes('fogo')) p.FOGO += v;
                if(k.includes('ar')) p.AR += v;
                if(k.includes('agua')) p.AGUA += v;
                if(k.includes('terra')) p.TERRA += v;
            });

            // Tempo Mod 1
            const t1 = d.tempos ? d.tempos[0] : 0;
            document.getElementById('mh-time').innerText = `‚è± Tempo: ${formatTime(t1)}`;

            const sorted = [
                { k:'FOGO', ...DB.FOGO, val: p.FOGO },
                { k:'AR', ...DB.AR, val: p.AR },
                { k:'AGUA', ...DB.AGUA, val: p.AGUA },
                { k:'TERRA', ...DB.TERRA, val: p.TERRA }
            ].sort((a,b) => b.val - a.val);

            const win = sorted[0];

            const chartC = document.getElementById('chart-container');
            chartC.innerHTML = ''; 
            sorted.forEach(item => {
                const pct = Math.min((item.val/25)*100, 100);
                chartC.innerHTML += `
                    <div class="cc-box">
                        <div class="cc-top"><span class="cc-lbl c-${item.class}">${item.id}</span><span class="cc-val c-${item.class}">${item.val}</span></div>
                        <div class="cc-bar"><div class="cc-fill bg-${item.class}" style="width:${pct}%"></div></div>
                    </div>
                `;
            });

            document.getElementById('wb-head').style.backgroundColor = win.cor;
            document.getElementById('txt-el').innerText = `ELEMENTO ${win.id}`;
            document.getElementById('txt-tit').innerText = win.titulo;
            document.getElementById('t-en').innerText = win.energia;
            document.getElementById('t-qm').innerText = win.quem;
            document.getElementById('t-perf').innerText = win.perfil;
            document.getElementById('t-temp').innerText = win.temp;
            document.getElementById('t-arq').innerText = win.arq;
            document.getElementById('l-est').innerHTML = win.estilos.map(i => `<li class="lst-li">${i}</li>`).join('');
            document.getElementById('l-car').innerHTML = win.carac.map(i => `<li class="lst-li">${i}</li>`).join('');

            const rkList = document.getElementById('rank-list');
            rkList.innerHTML = '';
            sorted.forEach((item, i) => {
                let label = "";
                if(i===0) label = "Dominante";
                if(i===1) label = "Secund√°rio";
                if(i===3) label = "A Desenvolver";
                rkList.innerHTML += `
                    <div class="rk-item">
                        <span class="rk-n">${i+1}¬∫ ${item.id} <span style="font-weight:400; color:#555">(${item.val} pts)</span></span>
                        <span class="rk-d">${label}</span>
                    </div>
                `;
            });

            // M√ìDULO 2 (VISUAL)
            const t2 = d.tempos ? d.tempos[1] : 0;
            document.getElementById('vis-time').innerText = `‚è± Tempo: ${formatTime(t2)}`;
            if (t2 > 0 && t2 < 60) {
                document.getElementById('vis-warning').style.display = 'block';
            } else {
                document.getElementById('vis-warning').style.display = 'none';
            }

            let visualScores = [];
            Object.keys(r).forEach(k => {
                if (k.startsWith('est_')) {
                    visualScores.push({
                        id: k,
                        nome: DB_VISUAL[k] || k,
                        val: parseInt(r[k]) || 0
                    });
                }
            });

            visualScores.sort((a,b) => b.val - a.val);

            if (visualScores.length > 0) {
                const top1 = visualScores[0];
                document.getElementById('vis-top1-nome').innerText = top1.nome;
                document.getElementById('vis-top1-nota').innerText = top1.val;
            } else {
                document.getElementById('vis-top1-nome').innerText = "N√£o Avaliado";
                document.getElementById('vis-top1-nota').innerText = "0";
            }

            const secContainer = document.getElementById('vis-lista-secundaria');
            secContainer.innerHTML = '';
            visualScores.slice(1, 5).forEach((item, i) => {
                secContainer.innerHTML += `
                    <div class="rk-item">
                        <span class="rk-n">${i+2}¬∫ ${item.nome}</span>
                        <span class="rk-d" style="font-weight:bold; color:#333;">${item.val}%</span>
                    </div>
                `;
            });

            // EXPORTAR
            const el = document.getElementById('pdf-root');
            el.style.display = 'block';
            window.scrollTo(0, 0); 

            setTimeout(async () => {
                const opt = {
                    margin: 0,
                    filename: `Dossie_${d.cliente}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, scrollY: 0, useCORS: true }, 
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                await html2pdf().set(opt).from(el).save();
                el.style.display = 'none';
                btn.innerText = original; btn.disabled = false;
            }, 1000);
        }

        init();
    </script>
</body>
</html>